{"resources":[{"type":"provider","name":"aws","body":{"region":"us-east-1","shared_credentials_file":"/Users/james.n.wilson/.aws/credentials","profile":"sandbox1"}},{"type":"terraform","body":{"required_version":"= 0.11.2","backend":{"type":"inner","name":"s3","body":{"bucket":"acp-platform-s-policy-sandbox1","key":"infrastructure/terraform.tfstate","region":"us-east-1"}}}},{"type":"terraform_remote_state","name":"acp-platform-s-policy-sandbox1_remote_state","body":{"config":{"bucket":"acp-platform-s-policy-sandbox1","key":"infrastructure/terraform.tfstate","region":"us-east-1"},"backend":"s3"}},{"type":"aws_sqs_queue","name":"policy_execution-queue","body":{"name":"policy_execution-queue","lifecycle":{"prevent_destroy":"true"},"message_retention_seconds":"3600.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-queue","CreatedBy":"Platform.S create-infra.py"},"visibility_timeout_seconds":"60.0","policy":{"Version":"2012-10-17","Id":"arn:aws:sqs:us-east-1:309983114184:policy_execution-queue/SNStoSQSPolicy","Statement":[{"Sid":"","Effect":"Allow","Principal":{"AWS":"*"},"Action":"SQS:SendMessage","Resource":"arn:aws:sqs:us-east-1:309983114184:policy_execution-queue","Condition":{"ArnEquals":{"aws:SourceArn":"arn:aws:sns:us-east-1:309983114184:policy_execution-notifier-topic"}}}]},"redrive_policy":{"deadLetterTargetArn":"${aws_sqs_queue.policy_execution-deadletter-queue.arn}","maxReceiveCount":"2.0"}}},{"type":"aws_sqs_queue","name":"policy_execution-deadletter-queue","body":{"lifecycle":{"prevent_destroy":"true"},"tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-deadletter-queue","CreatedBy":"Platform.S create-infra.py"},"name":"policy_execution-deadletter-queue","message_retention_seconds":"604800.0"}},{"type":"aws_sns_topic","name":"policy_scheduled-policy-topic","body":{"name":"policy_scheduled-policy-topic"}},{"type":"aws_sns_topic","name":"policy_trigger-policy-scheduler-topic","body":{"policy":{"Statement":[{"Action":["sns:Publish"],"Effect":"Allow","Principal":{"Service":"events.amazonaws.com"},"Resource":["arn:aws:sns:us-east-1:309983114184:policy_trigger-policy-scheduler-topic"]}],"Version":"2012-10-17"},"name":"policy_trigger-policy-scheduler-topic"}},{"type":"aws_lambda_permission","name":"policy_trigger-policy-scheduler-topic_invoke","body":{"statement_id":"policy_trigger-policy-scheduler-topic_invoke","action":"lambda:InvokeFunction","source_arn":"aws_sns_topic.policy_trigger-policy-scheduler-topic.arn","function_name":"aws_lambda_function.policy_scheduler.arn","principal":"sns.amazonaws.com"}},{"type":"aws_sns_topic","name":"policy_compliance-watch-violations-topic","body":{"name":"policy_compliance-watch-violations-topic"}},{"type":"aws_sns_topic","name":"policy_execution-notifier-topic","body":{"policy":{"Version":"2012-10-17","Statement":[{"Action":"SNS:Publish","Resource":"arn:aws:sns:*:*:policy_execution-notifier-topic","Effect":"Allow","Condition":{"ArnLike":{"aws:SourceArn":"arn:aws:s3:::acp-platform-s-policy-sandbox1"}},"Principal":{"Service":"s3.amazonaws.com"}}]},"name":"policy_execution-notifier-topic"}},{"type":"aws_sns_topic_subscription","name":"policy_execution-notifier-topic_Sub_sqs_policy_execution-queue","body":{"protocol":"sqs","endpoint":"aws_sqs_queue.policy_execution-queue.arn","topic_arn":"aws_sns_topic.policy_execution-notifier-topic.arn"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_condition_ReadThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables ReadThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_condition"},"alarm_name":"policy_condition_ReadThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_condition_ReadThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"ReadThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_condition_WriteThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables WriteThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_condition"},"alarm_name":"policy_condition_WriteThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_condition_WriteThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"WriteThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_dynamodb_table","name":"policy_condition","body":{"point_in_time_recovery":{"enabled":"true"},"read_capacity":"2.0","hash_key":"id","name":"policy_condition","lifecycle":{"prevent_destroy":"true"},"write_capacity":"2.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_condition","CreatedBy":"Platform.S create-infra.py"},"attribute":{"name":"id","type":"S"}}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_action_ReadThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables ReadThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_action"},"alarm_name":"policy_action_ReadThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_action_ReadThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"ReadThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_action_WriteThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables WriteThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_action"},"alarm_name":"policy_action_WriteThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_action_WriteThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"WriteThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_dynamodb_table","name":"policy_action","body":{"point_in_time_recovery":{"enabled":"true"},"read_capacity":"2.0","hash_key":"id","name":"policy_action","lifecycle":{"prevent_destroy":"true"},"write_capacity":"2.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_action","CreatedBy":"Platform.S create-infra.py"},"attribute":{"name":"id","type":"S"}}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_policy_ReadThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables ReadThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_policy"},"alarm_name":"policy_policy_ReadThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_policy_ReadThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"ReadThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_policy_WriteThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables WriteThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_policy"},"alarm_name":"policy_policy_WriteThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_policy_WriteThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"WriteThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_dynamodb_table","name":"policy_policy","body":{"point_in_time_recovery":{"enabled":"true"},"read_capacity":"2.0","range_key":"id","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_policy","CreatedBy":"Platform.S create-infra.py"},"write_capacity":"2.0","hash_key":"tenantId","name":"policy_policy","lifecycle":{"prevent_destroy":"true"},"stream_view_type":"NEW_AND_OLD_IMAGES","attribute":{"name":"id","type":"S"},"attribute":{"name":"tenantId","type":"S"},"stream_enabled":"true"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_whitelist_ReadThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables ReadThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_whitelist"},"alarm_name":"policy_whitelist_ReadThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist_ReadThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"ReadThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_whitelist_WriteThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables WriteThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_whitelist"},"alarm_name":"policy_whitelist_WriteThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist_WriteThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"WriteThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_dynamodb_table","name":"policy_whitelist","body":{"point_in_time_recovery":{"enabled":"true"},"read_capacity":"2.0","hash_key":"tenantId","name":"policy_whitelist","lifecycle":{"prevent_destroy":"true"},"write_capacity":"2.0","range_key":"accountId","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist","CreatedBy":"Platform.S create-infra.py"},"attribute":{"name":"accountId","type":"S"},"attribute":{"name":"tenantId","type":"S"}}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_definition_ReadThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables ReadThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_definition"},"alarm_name":"policy_definition_ReadThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition_ReadThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"ReadThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_definition_WriteThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables WriteThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_definition"},"alarm_name":"policy_definition_WriteThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition_WriteThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"WriteThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_dynamodb_table","name":"policy_definition","body":{"point_in_time_recovery":{"enabled":"true"},"read_capacity":"2.0","hash_key":"tenantId","name":"policy_definition","lifecycle":{"prevent_destroy":"true"},"write_capacity":"2.0","range_key":"id","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition","CreatedBy":"Platform.S create-infra.py"},"global_secondary_index":{"name":"lastExecutionDate","hash_key":"state","range_key":"lastExecution","projection_type":"ALL","write_capacity":"2.0","read_capacity":"2.0"},"global_secondary_index":{"name":"nextExecutionDate","hash_key":"state","range_key":"nextExecution","projection_type":"ALL","write_capacity":"2.0","read_capacity":"2.0"},"attribute":{"name":"tenantId","type":"S"},"attribute":{"name":"id","type":"S"},"attribute":{"name":"state","type":"S"},"attribute":{"name":"lastExecution","type":"N"},"attribute":{"name":"nextExecution","type":"N"}}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_executions_ReadThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables ReadThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_executions"},"alarm_name":"policy_executions_ReadThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_executions_ReadThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"ReadThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_executions_WriteThrottleEvents_capacityAlarm","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual tables WriteThrottleEvents","period":"60.0","datapoints_to_alarm":"1.0","dimensions":{"TableName":"policy_executions"},"alarm_name":"policy_executions_WriteThrottleEvents_capacityAlarm","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_executions_WriteThrottleEvents_capacityAlarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"WriteThrottleEvents","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/DynamoDB","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_dynamodb_table","name":"policy_executions","body":{"point_in_time_recovery":{"enabled":"true"},"read_capacity":"2.0","ttl":{"attribute_name":"ttl","enabled":"true"},"hash_key":"tenantId","name":"policy_executions","lifecycle":{"prevent_destroy":"false"},"write_capacity":"2.0","range_key":"id","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_executions","CreatedBy":"Platform.S create-infra.py"},"stream_view_type":"NEW_AND_OLD_IMAGES","global_secondary_index":{"name":"policyIdDate","hash_key":"policyId","range_key":"stateChangeDate","projection_type":"ALL","write_capacity":"2.0","read_capacity":"2.0"},"global_secondary_index":{"name":"policyIdState","hash_key":"policyId","range_key":"state","projection_type":"ALL","write_capacity":"2.0","read_capacity":"2.0"},"global_secondary_index":{"name":"tenantIdStateChangeDate","hash_key":"tenantId","range_key":"stateChangeDate","projection_type":"ALL","write_capacity":"2.0","read_capacity":"2.0"},"global_secondary_index":{"name":"tenantIdState","hash_key":"tenantId","range_key":"state","projection_type":"ALL","write_capacity":"2.0","read_capacity":"2.0"},"attribute":{"name":"tenantId","type":"S"},"attribute":{"name":"id","type":"S"},"attribute":{"name":"policyId","type":"S"},"attribute":{"name":"stateChangeDate","type":"N"},"attribute":{"name":"state","type":"S"},"stream_enabled":"true"}},{"type":"aws_iam_role","name":"policy_scheduler_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_scheduler_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_scheduler_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_scheduler_role_policy","body":{"depends_on":["aws_iam_role.policy_scheduler_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_scheduler*"]},{"Action":["dynamodb:Scan","dynamodb:Query","dynamodb:BatchGetItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_condition/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_condition","arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy","arn:aws:dynamodb:us-east-1:309983114184:table/policy_action/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_action"]},{"Action":["dynamodb:UpdateItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy"]},{"Action":["sns:Publish"],"Effect":"Allow","Resource":["arn:aws:sns:us-east-1:309983114184:policy_scheduled-policy-topic"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_scheduler_role.id","name":"policy_scheduler_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_scheduler_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_scheduler"},"alarm_name":"policy_scheduler_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_scheduler_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_scheduler_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_scheduler"},"alarm_name":"policy_scheduler_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_scheduler_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_scheduler","body":{"function_name":"policy_scheduler","depends_on":["aws_iam_role.policy_scheduler_role"],"lifecycle":{"ignore_changes":["handler","environment"]},"filename":"/tmp/nodejs_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_scheduler","CreatedBy":"Platform.S create-infra.py"},"handler":"lib/index.handler","memory_size":"128.0","timeout":"180.0","role":"aws_iam_role.policy_scheduler_role.arn","runtime":"nodejs8.10","description":"This will identify all scheduled policies and schedule them to run."}},{"type":"aws_lambda_permission","name":"policy_scheduler__trigger--scheduler-topic_sns_invoke_lambda_permission","body":{"statement_id":"policy_scheduler__trigger--scheduler-topic_sns_invoke_lambda_permission","depends_on":["aws_lambda_function.policy_scheduler"],"source_arn":"aws_sns_topic.policy_trigger-policy-scheduler-topic.arn","action":"lambda:InvokeFunction","function_name":"aws_lambda_function.policy_scheduler.arn","principal":"sns.amazonaws.com"}},{"type":"aws_sns_topic_subscription","name":"policy_scheduler_Sub_policy_trigger-policy-scheduler-topic","body":{"depends_on":["aws_lambda_function.policy_scheduler"],"topic_arn":"aws_sns_topic.policy_trigger-policy-scheduler-topic.arn","endpoint":"aws_lambda_function.policy_scheduler.arn","protocol":"lambda"}},{"type":"aws_iam_role","name":"policy_executor_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_executor_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_executor_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_executor_role_policy","body":{"depends_on":["aws_iam_role.policy_executor_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_executor*"]},{"Action":["dynamodb:GetItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_condition/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_condition","arn:aws:dynamodb:us-east-1:309983114184:table/policy_action/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_action"]},{"Action":["dynamodb:GetItem","dynamodb:UpdateItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy"]},{"Action":["dynamodb:Scan"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]},{"Action":["sns:Publish"],"Effect":"Allow","Resource":["arn:aws:sns:us-east-1:309983114184:action_send-email-topic","arn:aws:sns:us-east-1:309983114184:action_post-to-slack-topic"]},{"Action":["sns:Publish"],"Effect":"Allow","Resource":["arn:aws:sns:us-east-1:309983114184:policy_compliance-watch-violations-topic"]},{"Action":["s3:ListBucket"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-action-sandbox1"]},{"Action":["s3:GetObject","s3:PutObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-action-sandbox1/report/*"]},{"Action":["s3:GetObject","s3:PutObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-action-sandbox1/tracker-sync/*"]},{"Action":["s3:ListBucket","s3:GetObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-policy-sandbox1","arn:aws:s3:::acp-platform-s-policy-sandbox1/env/*"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_executor_role.id","name":"policy_executor_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_executor_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_executor"},"alarm_name":"policy_executor_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_executor_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_executor_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_executor"},"alarm_name":"policy_executor_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_executor_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_executor","body":{"depends_on":["aws_iam_role.policy_executor_role"],"role":"aws_iam_role.policy_executor_role.arn","description":"Evaluate a policy and execute actions","function_name":"policy_executor","filename":"/tmp/nodejs_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_executor","CreatedBy":"Platform.S create-infra.py"},"handler":"lib/index.handler","memory_size":"1536.0","timeout":"900.0","runtime":"nodejs8.10","lifecycle":{"ignore_changes":["handler","environment"]}}},{"type":"aws_lambda_permission","name":"policy_executor__scheduled--topic_sns_invoke_lambda_permission","body":{"statement_id":"policy_executor__scheduled--topic_sns_invoke_lambda_permission","depends_on":["aws_lambda_function.policy_executor"],"source_arn":"aws_sns_topic.policy_scheduled-policy-topic.arn","action":"lambda:InvokeFunction","function_name":"aws_lambda_function.policy_executor.arn","principal":"sns.amazonaws.com"}},{"type":"aws_sns_topic_subscription","name":"policy_executor_Sub_policy_scheduled-policy-topic","body":{"depends_on":["aws_lambda_function.policy_executor"],"topic_arn":"aws_sns_topic.policy_scheduled-policy-topic.arn","endpoint":"aws_lambda_function.policy_executor.arn","protocol":"lambda"}},{"type":"aws_iam_role","name":"policy_api_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_api_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_api_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_api_role_policy","body":{"depends_on":["aws_iam_role.policy_api_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_api*"]},{"Action":["dynamodb:GetItem","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*","arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"]},{"Action":["dynamodb:GetItem","dynamodb:Query","dynamodb:UpdateItem","dynamodb:PutItem","dynamodb:DeleteItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_api_role.id","name":"policy_api_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_api_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_api"},"alarm_name":"policy_api_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_api_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_api_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_api"},"alarm_name":"policy_api_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_api_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_api","body":{"function_name":"policy_api","depends_on":["aws_iam_role.policy_api_role"],"role":"aws_iam_role.policy_api_role.arn","filename":"/tmp/python_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_api","CreatedBy":"Platform.S create-infra.py"},"handler":"index.handler","memory_size":"1024.0","timeout":"30.0","lifecycle":{"ignore_changes":["handler","environment"]},"runtime":"python3.6","description":"Policy API"}},{"type":"aws_iam_role","name":"policy_update-violations_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_update-violations_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_update-violations_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_update-violations_role_policy","body":{"depends_on":["aws_iam_role.policy_update-violations_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_update-violations*"]},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:DescribeStream","dynamodb:ListStreams"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_policy"]},{"Action":["s3:GetObject","s3:PutObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-action-sandbox1/tracker-sync/*"]},{"Action":["sns:Publish"],"Effect":"Allow","Resource":["arn:aws:sns:us-east-1:309983114184:policy_compliance-watch-violations-topic"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_update-violations_role.id","name":"policy_update-violations_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_update-violations_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_update-violations"},"alarm_name":"policy_update-violations_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_update-violations_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_update-violations_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_update-violations"},"alarm_name":"policy_update-violations_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_update-violations_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_update-violations","body":{"function_name":"policy_update-violations","depends_on":["aws_iam_role.policy_update-violations_role"],"role":"aws_iam_role.policy_update-violations_role.arn","filename":"/tmp/nodejs_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_update-violations","CreatedBy":"Platform.S create-infra.py"},"handler":"lib/index.handler","memory_size":"128.0","timeout":"60.0","runtime":"nodejs8.10","lifecycle":{"ignore_changes":["handler","environment"]},"description":"Updates violations with changes to a policy"}},{"type":"aws_lambda_event_source_mapping","name":"policy_update-violations_EvtMap_policy_stream","body":{"depends_on":["aws_lambda_function.policy_update-violations"],"starting_position":"TRIM_HORIZON","batch_size":"100.0","event_source_arn":"aws_dynamodb_table.policy_policy.stream_arn","function_name":"policy_update-violations"}},{"type":"aws_iam_role","name":"policy_whitelist-sync_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_whitelist-sync_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-sync_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_whitelist-sync_role_policy","body":{"depends_on":["aws_iam_role.policy_whitelist-sync_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_whitelist-sync*"]},{"Action":["dynamodb:Scan","dynamodb:GetItem","dynamodb:PutItem","dynamodb:DeleteItem","dynamodb:UpdateItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_whitelist-sync_role.id","name":"policy_whitelist-sync_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_whitelist-sync_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_whitelist-sync"},"alarm_name":"policy_whitelist-sync_runaway_alarm","statistic":"SampleCount","threshold":"500.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-sync_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_whitelist-sync_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_whitelist-sync"},"alarm_name":"policy_whitelist-sync_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-sync_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_whitelist-sync","body":{"function_name":"policy_whitelist-sync","depends_on":["aws_iam_role.policy_whitelist-sync_role"],"role":"aws_iam_role.policy_whitelist-sync_role.arn","filename":"/tmp/nodejs_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-sync","CreatedBy":"Platform.S create-infra.py"},"handler":"lib/index.handler","timeout":"300.0","memory_size":"128.0","runtime":"nodejs8.10","lifecycle":{"ignore_changes":["handler","environment"]},"description":"Synchronizes whitelist based on account_account data"}},{"type":"aws_lambda_permission","name":"policy_whitelist-sync_account_account-topic_sns_invoke_lambda_permission","body":{"statement_id":"policy_whitelist-sync_account_account-topic_sns_invoke_lambda_permission","depends_on":["aws_lambda_function.policy_whitelist-sync"],"source_arn":"arn:aws:sns:us-east-1:309983114184:account_account-topic","action":"lambda:InvokeFunction","function_name":"aws_lambda_function.policy_whitelist-sync.arn","principal":"sns.amazonaws.com"}},{"type":"aws_sns_topic_subscription","name":"policy_whitelist-sync_Sub_account_account-topic","body":{"depends_on":["aws_lambda_function.policy_whitelist-sync"],"topic_arn":"arn:aws:sns:us-east-1:309983114184:account_account-topic","endpoint":"aws_lambda_function.policy_whitelist-sync.arn","protocol":"lambda"}},{"type":"aws_iam_role","name":"policy_whitelist-suspended-accounts_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_whitelist-suspended-accounts_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-suspended-accounts_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_whitelist-suspended-accounts_role_policy","body":{"depends_on":["aws_iam_role.policy_whitelist-suspended-accounts_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_whitelist-suspended-accounts*"]},{"Action":["dynamodb:Scan","dynamodb:GetItem","dynamodb:PutItem","dynamodb:DeleteItem","dynamodb:UpdateItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]},{"Action":["s3:ListBucket","s3:GetObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-policy-sandbox1","arn:aws:s3:::acp-platform-s-policy-sandbox1/env/*"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_whitelist-suspended-accounts_role.id","name":"policy_whitelist-suspended-accounts_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_whitelist-suspended-accounts_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_whitelist-suspended-accounts"},"alarm_name":"policy_whitelist-suspended-accounts_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-suspended-accounts_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_whitelist-suspended-accounts_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_whitelist-suspended-accounts"},"alarm_name":"policy_whitelist-suspended-accounts_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-suspended-accounts_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_whitelist-suspended-accounts","body":{"depends_on":["aws_iam_role.policy_whitelist-suspended-accounts_role"],"role":"aws_iam_role.policy_whitelist-suspended-accounts_role.arn","description":"Synchronizes whitelist based on suspended account discovery endpoint data","function_name":"policy_whitelist-suspended-accounts","filename":"/tmp/nodejs_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-suspended-accounts","CreatedBy":"Platform.S create-infra.py"},"handler":"lib/index.handler","memory_size":"128.0","timeout":"300.0","lifecycle":{"ignore_changes":["handler","environment"]},"runtime":"nodejs8.10"}},{"type":"aws_iam_role","name":"policy_execution-scheduler_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_execution-scheduler_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-scheduler_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_execution-scheduler_role_policy","body":{"depends_on":["aws_iam_role.policy_execution-scheduler_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_execution-scheduler*"]},{"Action":["dynamodb:GetItem","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*","arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"]},{"Action":["dynamodb:GetItem","dynamodb:UpdateItem","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition"]},{"Action":["dynamodb:GetItem","dynamodb:Query","dynamodb:Scan","dynamodb:PutItem","dynamodb:BatchWriteItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions"]},{"Action":["dynamodb:Scan","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]},{"Action":["sns:Publish"],"Effect":"Allow","Resource":["arn:aws:sns:us-east-1:309983114184:policy_execution-notifier-topic"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_execution-scheduler_role.id","name":"policy_execution-scheduler_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-scheduler_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_execution-scheduler"},"alarm_name":"policy_execution-scheduler_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-scheduler_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-scheduler_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_execution-scheduler"},"alarm_name":"policy_execution-scheduler_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-scheduler_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_execution-scheduler","body":{"function_name":"policy_execution-scheduler","depends_on":["aws_iam_role.policy_execution-scheduler_role"],"role":"aws_iam_role.policy_execution-scheduler_role.arn","filename":"/tmp/python_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-scheduler","CreatedBy":"Platform.S create-infra.py"},"handler":"index.handler","memory_size":"1024.0","timeout":"30.0","lifecycle":{"ignore_changes":["handler","environment"]},"runtime":"python3.6","description":"Schedules policy definitions for execution"}},{"type":"aws_iam_role","name":"policy_execution-processor_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_execution-processor_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-processor_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_execution-processor_role_policy","body":{"depends_on":["aws_iam_role.policy_execution-processor_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_execution-processor*"]},{"Action":["s3:ListBucket","s3:GetObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-policy-sandbox1","arn:aws:s3:::acp-platform-s-policy-sandbox1/env/*"]},{"Action":["s3:ListBucket"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-action-sandbox1"]},{"Action":["s3:GetObject","s3:PutObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-action-sandbox1/tracker-sync/*"]},{"Action":["s3:GetObject","s3:PutObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-action-sandbox1/report/*"]},{"Action":["dynamodb:GetItem","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*","arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"]},{"Action":["dynamodb:GetItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem","dynamodb:PutItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions"]},{"Action":["dynamodb:GetItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition"]},{"Action":["dynamodb:Scan","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]},{"Action":["sqs:GetQueueAttributes","sqs:DeleteMessage","sqs:ChangeMessageVisibility","sqs:DeleteMessageBatch","sqs:ChangeMessageVisibilityBatch","sqs:ReceiveMessage"],"Effect":"Allow","Resource":["${aws_sqs_queue.policy_execution-queue.arn}","${aws_sqs_queue.policy_execution-deadletter-queue.arn}"]},{"Action":["sns:Publish"],"Effect":"Allow","Resource":["arn:aws:sns:us-east-1:309983114184:action_send-email-topic"]},{"Action":["sns:Publish"],"Effect":"Allow","Resource":["arn:aws:sns:us-east-1:309983114184:policy_compliance-watch-violations-topic"]},{"Action":["es:ESHttpGet"],"Effect":"Allow","Resource":["arn:aws:es:us-east-1:309983114184:domain/governance/*"]},{"Action":["es:DescribeElasticsearchDomain"],"Effect":"Allow","Resource":["arn:aws:es:us-east-1:309983114184:domain/governance"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_execution-processor_role.id","name":"policy_execution-processor_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-processor_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_execution-processor"},"alarm_name":"policy_execution-processor_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-processor_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-processor_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_execution-processor"},"alarm_name":"policy_execution-processor_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-processor_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_execution-processor","body":{"role":"aws_iam_role.policy_execution-processor_role.arn","depends_on":["aws_iam_role.policy_execution-processor_role"],"description":"Executes sheduled policy","function_name":"policy_execution-processor","filename":"/tmp/python_lambda_stub.zip","reserved_concurrent_executions":"10.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-processor","CreatedBy":"Platform.S create-infra.py"},"handler":"index.handler","timeout":"60.0","memory_size":"1024.0","runtime":"python3.6","lifecycle":{"ignore_changes":["handler","environment"]}}},{"type":"aws_lambda_event_source_mapping","name":"policy_execution-processor_EvtMap_policy_execution","body":{"depends_on":["aws_lambda_function.policy_execution-processor"],"batch_size":"10.0","event_source_arn":"aws_sqs_queue.policy_execution-queue.arn","function_name":"policy_execution-processor"}},{"type":"aws_iam_role","name":"policy_definition-validator_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_definition-validator_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-validator_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_definition-validator_role_policy","body":{"depends_on":["aws_iam_role.policy_definition-validator_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_definition-validator*"]},{"Action":["s3:ListBucket","s3:GetObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-policy-sandbox1","arn:aws:s3:::acp-platform-s-policy-sandbox1/env/*"]},{"Action":["dynamodb:GetItem","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*","arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"]},{"Action":["dynamodb:GetItem","dynamodb:Query","dynamodb:UpdateItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition"]},{"Action":["dynamodb:Scan","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_definition-validator_role.id","name":"policy_definition-validator_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_definition-validator_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_definition-validator"},"alarm_name":"policy_definition-validator_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-validator_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_definition-validator_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_definition-validator"},"alarm_name":"policy_definition-validator_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-validator_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_definition-validator","body":{"depends_on":["aws_iam_role.policy_definition-validator_role"],"role":"aws_iam_role.policy_definition-validator_role.arn","description":"Policy validator","function_name":"policy_definition-validator","filename":"/tmp/python_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-validator","CreatedBy":"Platform.S create-infra.py"},"handler":"index.handler","memory_size":"1024.0","timeout":"30.0","lifecycle":{"ignore_changes":["handler","environment"]},"runtime":"python3.6"}},{"type":"aws_iam_role","name":"policy_definition-api_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_definition-api_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-api_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_definition-api_role_policy","body":{"depends_on":["aws_iam_role.policy_definition-api_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_definition-api*"]},{"Action":["s3:ListBucket","s3:GetObject"],"Effect":"Allow","Resource":["arn:aws:s3:::acp-platform-s-policy-sandbox1","arn:aws:s3:::acp-platform-s-policy-sandbox1/env/*"]},{"Action":["dynamodb:GetItem","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*","arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"]},{"Action":["dynamodb:GetItem","dynamodb:Query","dynamodb:UpdateItem","dynamodb:PutItem","dynamodb:DeleteItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_definition"]},{"Action":["dynamodb:Scan","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]},{"Action":["lambda:InvokeFunction"],"Effect":"Allow","Resource":["arn:aws:lambda:us-east-1:309983114184:function:policy_definition-validator"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_definition-api_role.id","name":"policy_definition-api_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_definition-api_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_definition-api"},"alarm_name":"policy_definition-api_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-api_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_definition-api_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_definition-api"},"alarm_name":"policy_definition-api_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-api_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_definition-api","body":{"depends_on":["aws_iam_role.policy_definition-api_role"],"role":"aws_iam_role.policy_definition-api_role.arn","description":"Policy definition API for CRUD operations","function_name":"policy_definition-api","filename":"/tmp/python_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_definition-api","CreatedBy":"Platform.S create-infra.py"},"handler":"index.handler","memory_size":"1024.0","timeout":"30.0","lifecycle":{"ignore_changes":["handler","environment"]},"runtime":"python3.6"}},{"type":"aws_iam_role","name":"policy_execution-api_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_execution-api_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-api_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_execution-api_role_policy","body":{"depends_on":["aws_iam_role.policy_execution-api_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_execution-api*"]},{"Action":["dynamodb:GetItem","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*","arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*","arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"]},{"Action":["dynamodb:GetItem","dynamodb:Query","dynamodb:UpdateItem","dynamodb:UpdateItem"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions"]},{"Action":["dynamodb:Scan","dynamodb:Query"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_whitelist"]},{"Action":["es:ESHttpGet","es:ESHttpDelete","es:ESHttpHead","es:ESHttpPost","es:ESHttpPut"],"Effect":"Allow","Resource":["arn:aws:es:us-east-1:309983114184:domain/governance/*"]},{"Action":["es:DescribeElasticsearchDomain"],"Effect":"Allow","Resource":["arn:aws:es:us-east-1:309983114184:domain/governance"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_execution-api_role.id","name":"policy_execution-api_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-api_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_execution-api"},"alarm_name":"policy_execution-api_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-api_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-api_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_execution-api"},"alarm_name":"policy_execution-api_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-api_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_execution-api","body":{"function_name":"policy_execution-api","depends_on":["aws_iam_role.policy_execution-api_role"],"role":"aws_iam_role.policy_execution-api_role.arn","filename":"/tmp/python_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-api","CreatedBy":"Platform.S create-infra.py"},"handler":"index.handler","memory_size":"1024.0","timeout":"30.0","lifecycle":{"ignore_changes":["handler","environment"]},"runtime":"python3.6","description":"API for listing and updating Policy execution records"}},{"type":"aws_iam_role","name":"policy_execution-stream-processor_role","body":{"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":["lambda.amazonaws.com"]},"Sid":""}],"Version":"2012-10-17"},"name":"policy_execution-stream-processor_role","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-stream-processor_role","CreatedBy":"Platform.S create-infra.py"}}},{"type":"aws_iam_role_policy","name":"policy_execution-stream-processor_role_policy","body":{"depends_on":["aws_iam_role.policy_execution-stream-processor_role"],"policy":{"Statement":[{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:log-group:/aws/lambda/*policy_execution-stream-processor*"]},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:DescribeStream","dynamodb:ListStreams"],"Effect":"Allow","Resource":["arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions/*","arn:aws:dynamodb:us-east-1:309983114184:table/policy_executions"]},{"Action":["es:ESHttpGet","es:ESHttpDelete","es:ESHttpHead","es:ESHttpPost","es:ESHttpPut"],"Effect":"Allow","Resource":["arn:aws:es:us-east-1:309983114184:domain/governance/*"]},{"Action":["es:DescribeElasticsearchDomain"],"Effect":"Allow","Resource":["arn:aws:es:us-east-1:309983114184:domain/governance"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_execution-stream-processor_role.id","name":"policy_execution-stream-processor_role_policy"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-stream-processor_runaway_alarm","body":{"evaluation_periods":"6.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"300.0","datapoints_to_alarm":"6.0","dimensions":{"FunctionName":"policy_execution-stream-processor"},"alarm_name":"policy_execution-stream-processor_runaway_alarm","statistic":"SampleCount","threshold":"100.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-stream-processor_runaway_alarm","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Invocations","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanOrEqualToThreshold"}},{"type":"aws_cloudwatch_metric_alarm","name":"policy_execution-stream-processor_lambda-errors","body":{"evaluation_periods":"1.0","alarm_description":"This metric monitors an individual lambdas invocations","period":"3600.0","datapoints_to_alarm":"1.0","dimensions":{"FunctionName":"policy_execution-stream-processor"},"alarm_name":"policy_execution-stream-processor_lambda-errors","statistic":"Sum","threshold":"0.0","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-stream-processor_lambda-errors","CreatedBy":"Platform.S create-infra.py"},"metric_name":"Errors","lifecycle":{"ignore_changes":["alarm_actions"]},"namespace":"AWS/Lambda","treat_missing_data":"notBreaching","comparison_operator":"GreaterThanThreshold"}},{"type":"aws_lambda_function","name":"policy_execution-stream-processor","body":{"function_name":"policy_execution-stream-processor","depends_on":["aws_iam_role.policy_execution-stream-processor_role"],"role":"aws_iam_role.policy_execution-stream-processor_role.arn","filename":"/tmp/python_lambda_stub.zip","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-stream-processor","CreatedBy":"Platform.S create-infra.py"},"handler":"index.handler","memory_size":"1024.0","timeout":"60.0","runtime":"python3.6","lifecycle":{"ignore_changes":["handler","environment"]},"description":"Syncs policy execution data from policy_executions DynamoDb table into Elasticsearch"}},{"type":"aws_lambda_event_source_mapping","name":"policy_execution-stream-processor_EvtMap_policy_execution","body":{"depends_on":["aws_lambda_function.policy_execution-stream-processor"],"starting_position":"TRIM_HORIZON","batch_size":"100.0","event_source_arn":"aws_dynamodb_table.policy_executions.stream_arn","function_name":"policy_execution-stream-processor"}},{"type":"aws_iam_role","name":"policy_gateway-invoke-lambda","body":{"tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_gateway-invoke-lambda","CreatedBy":"Platform.S create-infra.py"},"assume_role_policy":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"apigateway.amazonaws.com"},"Sid":""}],"Version":"2012-10-17"},"name":"policy_gateway-invoke-lambda"}},{"type":"aws_iam_role_policy","name":"policy_gateway-invoke-lambda_role_policy","body":{"policy":{"Statement":[{"Action":["lambda:InvokeFunction"],"Effect":"Allow","Resource":["arn:aws:lambda:us-east-1:309983114184:function:policy_api","arn:aws:lambda:us-east-1:309983114184:function:policy_definition-api","arn:aws:lambda:us-east-1:309983114184:function:policy_definition-validator","arn:aws:lambda:us-east-1:309983114184:function:policy_execution-api","arn:aws:lambda:us-east-1:309983114184:function:policy_execution-processor"]},{"Action":["logs:CreateLogStream","logs:CreateLogGroup","logs:PutLogEvents"],"Effect":"Allow","Resource":["arn:aws:logs:*:*:*"]}],"Version":"2012-10-17"},"role":"aws_iam_role.policy_gateway-invoke-lambda.id","name":"policy_gateway-invoke-lambda_role_policy"}},{"type":"aws_api_gateway_rest_api","name":"policy","body":{"name":"policy","binary_media_types":[]}},{"type":"aws_api_gateway_resource","name":"policy_deployment-v1_resource","body":{"parent_id":"aws_api_gateway_rest_api.policy.root_resource_id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"v1"}},{"type":"aws_api_gateway_resource","name":"policy_deployment-v1_resource_proxy","body":{"parent_id":"aws_api_gateway_resource.policy_deployment-v1_resource.id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"{proxy+}"}},{"type":"aws_api_gateway_method","name":"policy_integration_policy_deployment-v1_resource_ANY","body":{"http_method":"ANY","authorization":"NONE","rest_api_id":"aws_api_gateway_rest_api.policy.id","resource_id":"aws_api_gateway_resource.policy_deployment-v1_resource_proxy.id"}},{"type":"aws_api_gateway_integration","name":"policy_integration_policy_deployment-v1_resource_ANY_int","body":{"resource_id":"aws_api_gateway_resource.policy_deployment-v1_resource_proxy.id","uri":"arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.policy_api.arn}/invocations","http_method":"aws_api_gateway_method.policy_integration_policy_deployment-v1_resource_ANY.http_method","integration_http_method":"POST","rest_api_id":"aws_api_gateway_rest_api.policy.id","credentials":"aws_iam_role.policy_gateway-invoke-lambda.arn","type":"AWS_PROXY","request_templates":{"application/json":{"statusCode":"200.0"}}}},{"type":"aws_api_gateway_resource","name":"policy_deployment-definition_resource","body":{"parent_id":"aws_api_gateway_rest_api.policy.root_resource_id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"definition"}},{"type":"aws_api_gateway_resource","name":"policy_deployment-definition_resource_proxy","body":{"parent_id":"aws_api_gateway_resource.policy_deployment-definition_resource.id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"{proxy+}"}},{"type":"aws_api_gateway_method","name":"policy_integration_policy_deployment-definition_resource_ANY","body":{"http_method":"ANY","authorization":"NONE","rest_api_id":"aws_api_gateway_rest_api.policy.id","resource_id":"aws_api_gateway_resource.policy_deployment-definition_resource_proxy.id"}},{"type":"aws_api_gateway_integration","name":"policy_integration_policy_deployment-definition_resource_ANY_int","body":{"resource_id":"aws_api_gateway_resource.policy_deployment-definition_resource_proxy.id","uri":"arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.policy_definition-api.arn}/invocations","http_method":"aws_api_gateway_method.policy_integration_policy_deployment-definition_resource_ANY.http_method","integration_http_method":"POST","rest_api_id":"aws_api_gateway_rest_api.policy.id","credentials":"aws_iam_role.policy_gateway-invoke-lambda.arn","type":"AWS_PROXY","request_templates":{"application/json":{"statusCode":"200.0"}}}},{"type":"aws_api_gateway_resource","name":"policy_deployment-validation_resource","body":{"parent_id":"aws_api_gateway_rest_api.policy.root_resource_id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"validation"}},{"type":"aws_api_gateway_resource","name":"policy_deployment-validation_resource_proxy","body":{"parent_id":"aws_api_gateway_resource.policy_deployment-validation_resource.id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"{proxy+}"}},{"type":"aws_api_gateway_method","name":"policy_integration_policy_deployment-validation_resource_ANY","body":{"http_method":"ANY","authorization":"NONE","rest_api_id":"aws_api_gateway_rest_api.policy.id","resource_id":"aws_api_gateway_resource.policy_deployment-validation_resource_proxy.id"}},{"type":"aws_api_gateway_integration","name":"policy_integration_policy_deployment-validation_resource_ANY_int","body":{"resource_id":"aws_api_gateway_resource.policy_deployment-validation_resource_proxy.id","uri":"arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.policy_definition-validator.arn}/invocations","http_method":"aws_api_gateway_method.policy_integration_policy_deployment-validation_resource_ANY.http_method","integration_http_method":"POST","rest_api_id":"aws_api_gateway_rest_api.policy.id","credentials":"aws_iam_role.policy_gateway-invoke-lambda.arn","type":"AWS_PROXY","request_templates":{"application/json":{"statusCode":"200.0"}}}},{"type":"aws_api_gateway_resource","name":"policy_deployment-execution_resource","body":{"parent_id":"aws_api_gateway_rest_api.policy.root_resource_id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"execution"}},{"type":"aws_api_gateway_resource","name":"policy_deployment-execution_resource_proxy","body":{"parent_id":"aws_api_gateway_resource.policy_deployment-execution_resource.id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"{proxy+}"}},{"type":"aws_api_gateway_method","name":"policy_integration_policy_deployment-execution_resource_ANY","body":{"http_method":"ANY","authorization":"NONE","rest_api_id":"aws_api_gateway_rest_api.policy.id","resource_id":"aws_api_gateway_resource.policy_deployment-execution_resource_proxy.id"}},{"type":"aws_api_gateway_integration","name":"policy_integration_policy_deployment-execution_resource_ANY_int","body":{"resource_id":"aws_api_gateway_resource.policy_deployment-execution_resource_proxy.id","uri":"arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.policy_execution-api.arn}/invocations","http_method":"aws_api_gateway_method.policy_integration_policy_deployment-execution_resource_ANY.http_method","integration_http_method":"POST","rest_api_id":"aws_api_gateway_rest_api.policy.id","credentials":"aws_iam_role.policy_gateway-invoke-lambda.arn","type":"AWS_PROXY","request_templates":{"application/json":{"statusCode":"200.0"}}}},{"type":"aws_api_gateway_resource","name":"policy_deployment-processor_resource","body":{"parent_id":"aws_api_gateway_rest_api.policy.root_resource_id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"processor"}},{"type":"aws_api_gateway_resource","name":"policy_deployment-processor_resource_proxy","body":{"parent_id":"aws_api_gateway_resource.policy_deployment-processor_resource.id","rest_api_id":"aws_api_gateway_rest_api.policy.id","path_part":"{proxy+}"}},{"type":"aws_api_gateway_method","name":"policy_integration_policy_deployment-processor_resource_ANY","body":{"http_method":"ANY","authorization":"NONE","rest_api_id":"aws_api_gateway_rest_api.policy.id","resource_id":"aws_api_gateway_resource.policy_deployment-processor_resource_proxy.id"}},{"type":"aws_api_gateway_integration","name":"policy_integration_policy_deployment-processor_resource_ANY_int","body":{"resource_id":"aws_api_gateway_resource.policy_deployment-processor_resource_proxy.id","uri":"arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.policy_execution-processor.arn}/invocations","http_method":"aws_api_gateway_method.policy_integration_policy_deployment-processor_resource_ANY.http_method","integration_http_method":"POST","rest_api_id":"aws_api_gateway_rest_api.policy.id","credentials":"aws_iam_role.policy_gateway-invoke-lambda.arn","type":"AWS_PROXY","request_templates":{"application/json":{"statusCode":"200.0"}}}},{"type":"aws_api_gateway_base_path_mapping","name":"policy_deployment-base-path-mapping","body":{"stage_name":"sandbox1","depends_on":["aws_api_gateway_deployment.policy_deployment"],"domain_name":"api.sandbox1.cloudplatform.accenture.com","api_id":"aws_api_gateway_rest_api.policy.id","base_path":"policy"}},{"type":"aws_api_gateway_deployment","name":"policy_deployment","body":{"stage_name":"sandbox1","rest_api_id":"aws_api_gateway_rest_api.policy.id","depends_on":["aws_api_gateway_integration.policy_integration_policy_deployment-v1_resource_ANY_int","aws_api_gateway_integration.policy_integration_policy_deployment-definition_resource_ANY_int","aws_api_gateway_integration.policy_integration_policy_deployment-validation_resource_ANY_int","aws_api_gateway_integration.policy_integration_policy_deployment-execution_resource_ANY_int","aws_api_gateway_integration.policy_integration_policy_deployment-processor_resource_ANY_int"]}},{"type":"aws_cloudwatch_event_target","name":"policy_scheduler-rule_target","body":{"depends_on":["aws_cloudwatch_event_rule.policy_scheduler-rule","aws_sns_topic.policy_trigger-policy-scheduler-topic"],"target_id":"policy_scheduler-rule_target","arn":"aws_sns_topic.policy_trigger-policy-scheduler-topic.arn","rule":"policy_scheduler-rule"}},{"type":"aws_cloudwatch_event_rule","name":"policy_scheduler-rule","body":{"tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_scheduler-rule","CreatedBy":"Platform.S create-infra.py"},"description":"Schedule invocation of the scheduler lambda","schedule_expression":"rate(5 minutes)","name":"policy_scheduler-rule"}},{"type":"aws_cloudwatch_event_target","name":"policy_execution-scheduler-rule_target","body":{"depends_on":["aws_cloudwatch_event_rule.policy_execution-scheduler-rule","aws_lambda_function.policy_execution-scheduler"],"target_id":"policy_execution-scheduler-rule_target","arn":"aws_lambda_function.policy_execution-scheduler.arn","rule":"policy_execution-scheduler-rule"}},{"type":"aws_cloudwatch_event_rule","name":"policy_execution-scheduler-rule","body":{"description":"Schedules policy for execution","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_execution-scheduler-rule","CreatedBy":"Platform.S create-infra.py"},"schedule_expression":"rate(1 minute)","name":"policy_execution-scheduler-rule"}},{"type":"aws_lambda_permission","name":"policy_execution-scheduler-rule_invoke","body":{"statement_id":"policy_execution-scheduler-rule_invoke","action":"lambda:InvokeFunction","source_arn":"aws_cloudwatch_event_rule.policy_execution-scheduler-rule.arn","function_name":"aws_lambda_function.policy_execution-scheduler.arn","principal":"events.amazonaws.com"}},{"type":"aws_cloudwatch_event_target","name":"policy_whitelist-suspended-accounts-rule_target","body":{"depends_on":["aws_cloudwatch_event_rule.policy_whitelist-suspended-accounts-rule","aws_lambda_function.policy_whitelist-suspended-accounts"],"target_id":"policy_whitelist-suspended-accounts-rule_target","arn":"aws_lambda_function.policy_whitelist-suspended-accounts.arn","rule":"policy_whitelist-suspended-accounts-rule"}},{"type":"aws_cloudwatch_event_rule","name":"policy_whitelist-suspended-accounts-rule","body":{"description":"Schedules policy for whitelisting suspended accounts","tags":{"Environment":"sandbox1","Component":"policy","Name":"policy_whitelist-suspended-accounts-rule","CreatedBy":"Platform.S create-infra.py"},"schedule_expression":"rate(60 minutes)","name":"policy_whitelist-suspended-accounts-rule"}},{"type":"aws_lambda_permission","name":"policy_whitelist-suspended-accounts-rule_invoke","body":{"statement_id":"policy_whitelist-suspended-accounts-rule_invoke","action":"lambda:InvokeFunction","source_arn":"aws_cloudwatch_event_rule.policy_whitelist-suspended-accounts-rule.arn","function_name":"aws_lambda_function.policy_whitelist-suspended-accounts.arn","principal":"events.amazonaws.com"}}],"relationships":[{"in":"aws_sns_topic.policy_trigger-policy-scheduler-topic","out":"aws_lambda_function.policy_scheduler","label":""},{"in":"aws_iam_role.policy_scheduler_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_scheduler_role","out":"aws_dynamodb_table.policy_condition","label":"['dynamodb:Scan','dynamodb:Query','dynamodb:BatchGetItem']"},{"in":"aws_iam_role.policy_scheduler_role","out":"aws_dynamodb_table.policy_policy","label":"['dynamodb:Scan','dynamodb:Query','dynamodb:BatchGetItem']"},{"in":"aws_iam_role.policy_scheduler_role","out":"aws_dynamodb_table.policy_action","label":"['dynamodb:Scan','dynamodb:Query','dynamodb:BatchGetItem']"},{"in":"aws_iam_role.policy_scheduler_role","out":"aws_dynamodb_table.policy_policy","label":"['dynamodb:UpdateItem']"},{"in":"aws_iam_role.policy_scheduler_role","out":"aws_sns_topic.policy_scheduled-policy-topic","label":"['sns:Publish']"},{"in":"aws_lambda_function.policy_scheduler","out":"aws_iam_role.policy_scheduler_role","label":""},{"in":"aws_sns_topic.policy_trigger-policy-scheduler-topic","out":"aws_lambda_function.policy_scheduler","label":""},{"in":"aws_iam_role.policy_executor_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_dynamodb_table.policy_condition","label":"['dynamodb:GetItem']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_dynamodb_table.policy_action","label":"['dynamodb:GetItem']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_dynamodb_table.policy_policy","label":"['dynamodb:GetItem','dynamodb:UpdateItem']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_sns_topic.action_send-email-topic","label":"['sns:Publish']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_sns_topic.action_post-to-slack-topic","label":"['sns:Publish']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_sns_topic.policy_compliance-watch-violations-topic","label":"['sns:Publish']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_s3_bucket.acp-platform-s-action-sandbox1","label":"['s3:ListBucket']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_s3_bucket.acp-platform-s-action-sandbox1/report","label":"['s3:GetObject','s3:PutObject']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_s3_bucket.acp-platform-s-action-sandbox1/tracker-sync","label":"['s3:GetObject','s3:PutObject']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_executor_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1/env","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_lambda_function.policy_executor","out":"aws_iam_role.policy_executor_role","label":""},{"in":"aws_sns_topic.policy_scheduled-policy-topic","out":"aws_lambda_function.policy_executor","label":""},{"in":"aws_iam_role.policy_api_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_api_role","out":"aws_dynamodb_table.authorisation_token","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_api_role","out":"aws_dynamodb_table.authentication_key","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_api_role","out":"aws_dynamodb_table.policy_policy","label":"['dynamodb:GetItem','dynamodb:Query','dynamodb:UpdateItem','dynamodb:PutItem','dynamodb:DeleteItem']"},{"in":"aws_lambda_function.policy_api","out":"aws_iam_role.policy_api_role","label":""},{"in":"aws_iam_role.policy_update-violations_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_update-violations_role","out":"aws_dynamodb_table.policy_policy","label":"['dynamodb:GetRecords','dynamodb:GetShardIterator','dynamodb:DescribeStream','dynamodb:ListStreams']"},{"in":"aws_iam_role.policy_update-violations_role","out":"aws_s3_bucket.acp-platform-s-action-sandbox1/tracker-sync","label":"['s3:GetObject','s3:PutObject']"},{"in":"aws_iam_role.policy_update-violations_role","out":"aws_sns_topic.policy_compliance-watch-violations-topic","label":"['sns:Publish']"},{"in":"aws_lambda_function.policy_update-violations","out":"aws_iam_role.policy_update-violations_role","label":""},{"in":"aws_dynamodb_table.policy_policy.stream_arn","out":"aws_lambda_function.policy_update-violations","label":""},{"in":"aws_iam_role.policy_whitelist-sync_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_whitelist-sync_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan','dynamodb:GetItem','dynamodb:PutItem','dynamodb:DeleteItem','dynamodb:UpdateItem']"},{"in":"aws_lambda_function.policy_whitelist-sync","out":"aws_iam_role.policy_whitelist-sync_role","label":""},{"in":"arn:aws:sns:us-east-1:309983114184:account_account-topic","out":"aws_lambda_function.policy_whitelist-sync","label":""},{"in":"aws_iam_role.policy_whitelist-suspended-accounts_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_whitelist-suspended-accounts_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan','dynamodb:GetItem','dynamodb:PutItem','dynamodb:DeleteItem','dynamodb:UpdateItem']"},{"in":"aws_iam_role.policy_whitelist-suspended-accounts_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_whitelist-suspended-accounts_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1/env","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_lambda_function.policy_whitelist-suspended-accounts","out":"aws_iam_role.policy_whitelist-suspended-accounts_role","label":""},{"in":"aws_iam_role.policy_execution-scheduler_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_execution-scheduler_role","out":"aws_dynamodb_table.authorisation_token","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-scheduler_role","out":"aws_dynamodb_table.authentication_key","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-scheduler_role","out":"aws_dynamodb_table.policy_definition","label":"['dynamodb:GetItem','dynamodb:UpdateItem','dynamodb:PutItem','dynamodb:Query','dynamodb:Scan']"},{"in":"aws_iam_role.policy_execution-scheduler_role","out":"aws_dynamodb_table.policy_executions","label":"['dynamodb:GetItem','dynamodb:Query','dynamodb:Scan','dynamodb:PutItem','dynamodb:BatchWriteItem']"},{"in":"aws_iam_role.policy_execution-scheduler_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-scheduler_role","out":"aws_sns_topic.policy_execution-notifier-topic","label":"['sns:Publish']"},{"in":"aws_lambda_function.policy_execution-scheduler","out":"aws_iam_role.policy_execution-scheduler_role","label":""},{"in":"aws_iam_role.policy_execution-processor_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1/env","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_s3_bucket.acp-platform-s-action-sandbox1","label":"['s3:ListBucket']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_s3_bucket.acp-platform-s-action-sandbox1/tracker-sync","label":"['s3:GetObject','s3:PutObject']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_s3_bucket.acp-platform-s-action-sandbox1/report","label":"['s3:GetObject','s3:PutObject']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_dynamodb_table.authorisation_token","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_dynamodb_table.authentication_key","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_dynamodb_table.policy_executions","label":"['dynamodb:GetItem','dynamodb:Query','dynamodb:Scan','dynamodb:UpdateItem','dynamodb:PutItem']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_dynamodb_table.policy_definition","label":"['dynamodb:GetItem','dynamodb:Query','dynamodb:Scan','dynamodb:UpdateItem']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_sqs_queue.policy_execution-queue","label":"['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_sqs_queue.policy_execution-deadletter-queue","label":"['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_sns_topic.action_send-email-topic","label":"['sns:Publish']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"aws_sns_topic.policy_compliance-watch-violations-topic","label":"['sns:Publish']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"","label":"['es:ESHttpGet']"},{"in":"aws_iam_role.policy_execution-processor_role","out":"","label":"['es:DescribeElasticsearchDomain']"},{"in":"aws_lambda_function.policy_execution-processor","out":"aws_iam_role.policy_execution-processor_role","label":""},{"in":"aws_sqs_queue.policy_execution-queue","out":"aws_lambda_function.policy_execution-processor","label":""},{"in":"aws_iam_role.policy_definition-validator_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_definition-validator_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_definition-validator_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1/env","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_definition-validator_role","out":"aws_dynamodb_table.authorisation_token","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_definition-validator_role","out":"aws_dynamodb_table.authentication_key","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_definition-validator_role","out":"aws_dynamodb_table.policy_definition","label":"['dynamodb:GetItem','dynamodb:Query','dynamodb:UpdateItem']"},{"in":"aws_iam_role.policy_definition-validator_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan','dynamodb:Query']"},{"in":"aws_lambda_function.policy_definition-validator","out":"aws_iam_role.policy_definition-validator_role","label":""},{"in":"aws_iam_role.policy_definition-api_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_definition-api_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_definition-api_role","out":"aws_s3_bucket.acp-platform-s-policy-sandbox1/env","label":"['s3:ListBucket','s3:GetObject']"},{"in":"aws_iam_role.policy_definition-api_role","out":"aws_dynamodb_table.authorisation_token","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_definition-api_role","out":"aws_dynamodb_table.authentication_key","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_definition-api_role","out":"aws_dynamodb_table.policy_definition","label":"['dynamodb:GetItem','dynamodb:Query','dynamodb:UpdateItem','dynamodb:PutItem','dynamodb:DeleteItem']"},{"in":"aws_iam_role.policy_definition-api_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan','dynamodb:Query']"},{"in":"aws_iam_role.policy_definition-api_role","out":"aws_lambda_function.policy_definition-validator","label":"['lambda:InvokeFunction']"},{"in":"aws_lambda_function.policy_definition-api","out":"aws_iam_role.policy_definition-api_role","label":""},{"in":"aws_iam_role.policy_execution-api_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_execution-api_role","out":"aws_dynamodb_table.authorisation_token","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-api_role","out":"aws_dynamodb_table.authentication_key","label":"['dynamodb:GetItem','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-api_role","out":"aws_dynamodb_table.policy_executions","label":"['dynamodb:GetItem','dynamodb:Query','dynamodb:UpdateItem','dynamodb:UpdateItem']"},{"in":"aws_iam_role.policy_execution-api_role","out":"aws_dynamodb_table.policy_whitelist","label":"['dynamodb:Scan','dynamodb:Query']"},{"in":"aws_iam_role.policy_execution-api_role","out":"","label":"['es:ESHttpGet','es:ESHttpDelete','es:ESHttpHead','es:ESHttpPost','es:ESHttpPut']"},{"in":"aws_iam_role.policy_execution-api_role","out":"","label":"['es:DescribeElasticsearchDomain']"},{"in":"aws_lambda_function.policy_execution-api","out":"aws_iam_role.policy_execution-api_role","label":""},{"in":"aws_iam_role.policy_execution-stream-processor_role","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_iam_role.policy_execution-stream-processor_role","out":"aws_dynamodb_table.policy_executions","label":"['dynamodb:GetRecords','dynamodb:GetShardIterator','dynamodb:DescribeStream','dynamodb:ListStreams']"},{"in":"aws_iam_role.policy_execution-stream-processor_role","out":"","label":"['es:ESHttpGet','es:ESHttpDelete','es:ESHttpHead','es:ESHttpPost','es:ESHttpPut']"},{"in":"aws_iam_role.policy_execution-stream-processor_role","out":"","label":"['es:DescribeElasticsearchDomain']"},{"in":"aws_lambda_function.policy_execution-stream-processor","out":"aws_iam_role.policy_execution-stream-processor_role","label":""},{"in":"aws_dynamodb_table.policy_executions.stream_arn","out":"aws_lambda_function.policy_execution-stream-processor","label":""},{"in":"aws_iam_role.policy_gateway-invoke-lambda","out":"aws_lambda_function.policy_api","label":"['lambda:InvokeFunction']"},{"in":"aws_iam_role.policy_gateway-invoke-lambda","out":"aws_lambda_function.policy_definition-api","label":"['lambda:InvokeFunction']"},{"in":"aws_iam_role.policy_gateway-invoke-lambda","out":"aws_lambda_function.policy_definition-validator","label":"['lambda:InvokeFunction']"},{"in":"aws_iam_role.policy_gateway-invoke-lambda","out":"aws_lambda_function.policy_execution-api","label":"['lambda:InvokeFunction']"},{"in":"aws_iam_role.policy_gateway-invoke-lambda","out":"aws_lambda_function.policy_execution-processor","label":"['lambda:InvokeFunction']"},{"in":"aws_iam_role.policy_gateway-invoke-lambda","out":"","label":"['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"},{"in":"aws_cloudwatch_event_rule.policy_execution-scheduler-rule","out":"aws_lambda_function.policy_execution-scheduler","label":""},{"in":"aws_cloudwatch_event_rule.policy_whitelist-suspended-accounts-rule","out":"aws_lambda_function.policy_whitelist-suspended-accounts","label":""}],"policy_results":{"aws_lambda_function_policy_execution-stream-processor":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":true},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_iam_role_policy_policy_execution-scheduler_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_lambda_function_policy_whitelist-sync":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":false},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":true}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_lambda_function_policy_definition-validator":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":true},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_iam_role_policy_policy_update-violations_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_iam_role_policy_policy_whitelist-sync_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_lambda_function_policy_api":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":true},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_lambda_function_policy_execution-api":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":true},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_iam_role_policy_policy_execution-processor_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_iam_role_policy_policy_definition-api_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_iam_role_policy_policy_execution-api_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_lambda_function_policy_execution-processor":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":true},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_sqs_queue_policy_execution-deadletter-queue":[{"filters":[{"filter":{"key":"redrive_policy.maxReceiveCount","op":"eq","value":"3.1"},"result":false}],"policy_id":"sqs-max-receive-count-check","policy_result":false},{"filters":[{"filter":{"key":"policy.Version","op":"eq","value":"2012-10-17"},"result":false}],"policy_id":"sqs-has-inline-policy","policy_result":false}],"aws_lambda_function_policy_executor":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":false},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_iam_role_policy_policy_execution-stream-processor_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_sqs_queue_policy_execution-queue":[{"filters":[{"filter":{"key":"redrive_policy.maxReceiveCount","op":"eq","value":"3.1"},"result":false}],"policy_id":"sqs-max-receive-count-check","policy_result":false}],"aws_lambda_function_policy_definition-api":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":true},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_iam_role_policy_policy_whitelist-suspended-accounts_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_lambda_function_policy_scheduler":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":false},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":true}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_lambda_function_policy_whitelist-suspended-accounts":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":false},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":true}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_lambda_function_policy_execution-scheduler":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":true},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":false}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_lambda_function_policy_update-violations":[{"filters":[{"filter":{"key":"handler","op":"eq","value":"index.handler"},"result":false},{"filter":{"key":"memory_size","op":"eq","value":"128.0"},"result":true}],"policy_id":"find-nodesjs-lambdas","policy_result":false}],"aws_iam_role_policy_policy_scheduler_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_iam_role_policy_policy_executor_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_iam_role_policy_policy_api_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_iam_role_policy_policy_definition-validator_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}],"aws_iam_role_policy_policy_gateway-invoke-lambda_role_policy":[{"filters":[{"filter":{"key":"visibility_timeout_seconds","op":"eq","value":"3.1"},"result":false}],"policy_id":"policy-id-check","policy_result":false}]}}