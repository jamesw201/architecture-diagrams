{
  "resources": [
    {
      "type": "provider",
      "name": "aws",
      "body": {
        "region": "us-east-1",
        "shared_credentials_file": "/Users/james.n.wilson/.aws/credentials",
        "profile": "sandbox1"
      }
    },
    {
      "type": "terraform",
      "body": {
        "required_version": "= 0.11.2",
        "backend": {
          "type": "inner",
          "name": "s3",
          "body": {
            "bucket": "acp-platform-s-discovery-sandbox1",
            "key": "infrastructure/terraform.tfstate",
            "region": "us-east-1"
          }
        }
      }
    },
    {
      "type": "terraform_remote_state",
      "name": "acp-platform-s-discovery-sandbox1_remote_state",
      "body": {
        "config": {
          "bucket": "acp-platform-s-discovery-sandbox1",
          "key": "infrastructure/terraform.tfstate",
          "region": "us-east-1"
        },
        "backend": "s3"
      }
    },
    {
      "type": "aws_kms_key",
      "name": "discovery_cache-master-key",
      "body": {
        "description": "Master key used for creating/decrypting cache token data keys",
        "enable_key_rotation": "true",
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_kms_alias",
      "name": "discovery_cache-master-key",
      "body": {
        "name": "alias/discoverycache",
        "target_key_id": "aws_kms_key.discovery_cache-master-key.key_id"
      }
    },
    {
      "type": "aws_ecs_service",
      "name": "discovery_collector-service",
      "body": {
        "name": "discovery_collector-service",
        "cluster": "aws_ecs_cluster.discovery_platform-s-cluster.id",
        "task_definition": "aws_ecs_task_definition.discovery_collector-task-definition.arn",
        "desired_count": "1.0",
        "launch_type": "FARGATE",
        "deployment_minimum_healthy_percent": "10.0",
        "deployment_maximum_percent": "200.0",
        "network_configuration": {
          "subnets": [
            "aws_subnet.discovery_private-subnet-az-a.id",
            "aws_subnet.discovery_private-subnet-az-b.id"
          ],
          "security_groups": [
            "aws_security_group.discovery_cache-security-group1.id"
          ]
        },
        "depends_on": [
          "aws_iam_role.discovery_ecs-execution-role"
        ]
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_cloudwatch-collector-queue-cloudwatch-alaram-messages-high",
      "body": {
        "alarm_name": "discovery_cloudwatch-collector-queue-cloudwatch-alarm-messages-high",
        "alarm_description": "This alarm monitors the number of messages in the discovery_collector-queue for scaling up",
        "comparison_operator": "GreaterThanOrEqualToThreshold",
        "evaluation_periods": "1",
        "metric_name": "ApproximateNumberOfMessagesVisible",
        "namespace": "AWS/SQS",
        "period": "60",
        "statistic": "Average",
        "threshold": "1000",
        "dimensions": {
          "QueueName": "aws_sqs_queue.discovery_collector-queue.name"
        },
        "alarm_actions": [
          "aws_appautoscaling_policy.discovery_collector-autoscaling-up.arn"
        ]
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_collector-queue-cloudwatch-alaram-messages-low",
      "body": {
        "alarm_name": "discovery_collector-queue-cloudwatch-alarm-messages-low",
        "alarm_description": "This alarm monitors the number of messages in the discovery_collector-queue for scaling down",
        "comparison_operator": "LessThanThreshold",
        "evaluation_periods": "1",
        "metric_name": "ApproximateNumberOfMessagesVisible",
        "namespace": "AWS/SQS",
        "period": "60",
        "statistic": "Average",
        "threshold": "1000",
        "dimensions": {
          "QueueName": "aws_sqs_queue.discovery_collector-queue.name"
        },
        "alarm_actions": [
          "aws_appautoscaling_policy.discovery_collector-autoscaling-down.arn"
        ]
      }
    },
    {
      "type": "aws_appautoscaling_target",
      "name": "discovery_collector-autoscaling-target",
      "body": {
        "service_namespace": "ecs",
        "resource_id": "service/${aws_ecs_cluster.discovery_platform-s-cluster.name}/${aws_ecs_service.discovery_collector-service.name}",
        "scalable_dimension": "ecs:service:DesiredCount",
        "role_arn": "aws_iam_role.discovery_ecs-autoscale-role.arn",
        "min_capacity": "1.0",
        "max_capacity": "20.0",
        "depends_on": [
          "aws_ecs_cluster.discovery_platform-s-cluster",
          "aws_ecs_service.discovery_collector-service"
        ]
      }
    },
    {
      "type": "aws_appautoscaling_policy",
      "name": "discovery_collector-autoscaling-up",
      "body": {
        "name": "discovery_collector-autoscaling-up",
        "service_namespace": "ecs",
        "resource_id": "service/${aws_ecs_cluster.discovery_platform-s-cluster.name}/${aws_ecs_service.discovery_collector-service.name}",
        "scalable_dimension": "ecs:service:DesiredCount",
        "step_scaling_policy_configuration": {
          "adjustment_type": "ChangeInCapacity",
          "cooldown": "60.0",
          "metric_aggregation_type": "Average",
          "step_adjustment": {
            "metric_interval_lower_bound": "3000.0",
            "scaling_adjustment": "6.0"
          }
        },
        "depends_on": [
          "aws_appautoscaling_target.discovery_collector-autoscaling-target"
        ]
      }
    },
    {
      "type": "aws_appautoscaling_policy",
      "name": "discovery_collector-autoscaling-down",
      "body": {
        "name": "discovery_collector-autoscaling-down",
        "service_namespace": "ecs",
        "resource_id": "service/${aws_ecs_cluster.discovery_platform-s-cluster.name}/${aws_ecs_service.discovery_collector-service.name}",
        "scalable_dimension": "ecs:service:DesiredCount",
        "step_scaling_policy_configuration": {
          "adjustment_type": "ChangeInCapacity",
          "cooldown": "120.0",
          "metric_aggregation_type": "Average",
          "step_adjustment": {
            "metric_interval_upper_bound": "0.0",
            "scaling_adjustment": "-3.0"
          }
        },
        "depends_on": [
          "aws_appautoscaling_target.discovery_collector-autoscaling-target"
        ]
      }
    },
    {
      "type": "aws_ecs_service",
      "name": "discovery_diff-engine-service",
      "body": {
        "name": "discovery_diff-engine-service",
        "cluster": "aws_ecs_cluster.discovery_platform-s-cluster.id",
        "task_definition": "aws_ecs_task_definition.discovery_diff-engine-task-definition.arn",
        "desired_count": "1.0",
        "launch_type": "FARGATE",
        "deployment_minimum_healthy_percent": "10.0",
        "deployment_maximum_percent": "200.0",
        "network_configuration": {
          "subnets": [
            "aws_subnet.discovery_private-subnet-az-a.id",
            "aws_subnet.discovery_private-subnet-az-b.id"
          ],
          "security_groups": [
            "aws_security_group.discovery_cache-security-group1.id"
          ]
        },
        "depends_on": [
          "aws_iam_role.discovery_ecs-execution-role"
        ]
      }
    },
    {
      "type": "aws_cloudwatch_log_metric_filter",
      "name": "discovery_diff-tagging-failed-event-error",
      "body": {
        "name": "diff_tagging_failed_event",
        "pattern": "CAUTION Discovery diff-tagging lambda failed to process event.",
        "log_group_name": "/aws/lambda/discovery_diff-tagging",
        "metric_transformation": {
          "name": "diff_tagging_failed_event",
          "namespace": "diff_tagging_log_metrics",
          "value": "1"
        }
      }
    },
    {
      "type": "aws_lambda_event_source_mapping",
      "name": "discovery_publisher-lambda-sqs-mapping",
      "body": {
        "batch_size": "1.0",
        "event_source_arn": "aws_sqs_queue.discovery_publisher-queue.arn",
        "enabled": "true",
        "function_name": "aws_lambda_function.discovery_publisher.arn"
      }
    },
    {
      "type": "aws_lambda_event_source_mapping",
      "name": "discovery_consistency-checker-lambda-sqs-mapping",
      "body": {
        "batch_size": "1.0",
        "event_source_arn": "aws_sqs_queue.discovery_consistency-checker-queue.arn",
        "enabled": "false",
        "function_name": "aws_lambda_function.discovery_consistency-checker.arn"
      }
    },
    {
      "type": "aws_cloudwatch_dashboard",
      "name": "discovery_ops-dashboard",
      "body": {
        "dashboard_name": "discovery_ops-dashboard",
        "dashboard_body": {
          "widgets": [
            {
              "type": "metric",
              "x": "0.0",
              "y": "1.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Discovery Lambda Invocations",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "discovery_api",
                    "Resource",
                    "discovery_api",
                    {
                      "color": "#d62728",
                      "label": "discovery_api"
                    }
                  ],
                  [
                    ".",
                    ".",
                    ".",
                    "discovery_collector",
                    {
                      "color": "#e377c2"
                    }
                  ],
                  [
                    ".",
                    ".",
                    ".",
                    "discovery_default-config",
                    "Resource",
                    "discovery_default-config",
                    {
                      "color": "#ffbb78",
                      "label": "discovery_default-config"
                    }
                  ],
                  [
                    ".",
                    ".",
                    ".",
                    "discovery_diff-engine",
                    {
                      "color": "#ff9896"
                    }
                  ],
                  [
                    ".",
                    ".",
                    ".",
                    "discovery_event-adapter",
                    "Resource",
                    "discovery_event-adapter",
                    {
                      "color": "#f7b6d2",
                      "label": "discovery_event-adapter"
                    }
                  ],
                  [
                    "...",
                    "discovery_publisher",
                    ".",
                    "discovery_publisher",
                    {
                      "color": "#9467bd",
                      "label": "discovery_publisher"
                    }
                  ],
                  [
                    "...",
                    "discovery_scheduler",
                    ".",
                    "discovery_scheduler",
                    {
                      "color": "#c5b0d5"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "0.0",
              "y": "22.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Identity Lambda Invocations",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "identity_tenant-sync",
                    {
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    "...",
                    "identity_orgunit-sync",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    "...",
                    "acp3-identity-sync_identity-auth-sync",
                    {
                      "color": "#17becf"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "18.0",
              "y": "29.0",
              "width": "6.0",
              "height": "6.0",
              "properties": {
                "title": "Identity DynamoDB",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/DynamoDB",
                    "ProvisionedReadCapacityUnits",
                    "TableName",
                    "identity_tenant"
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#1f2cb4"
                    }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#414fde"
                    }
                  ],
                  [
                    ".",
                    "ConsumedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#20276f"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    "identity_organisational-unit",
                    {
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#951b1c"
                    }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#540f10"
                    }
                  ],
                  [
                    ".",
                    "ConsumedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#de5252"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    "authentication_key",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "ConsumedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#98df8a"
                    }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#dbdb8d"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedReadCapacityUnits",
                    ".",
                    "account_account",
                    {
                      "color": "#ff7f0e"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#ffbb78"
                    }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#ffa85b"
                    }
                  ],
                  [
                    ".",
                    "ConsumedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#c25a00"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    "secret_key",
                    {
                      "color": "#9467bd"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#c5b0d5"
                    }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#f7b6d2"
                    }
                  ],
                  [
                    ".",
                    "ConsumedWriteCapacityUnits",
                    ".",
                    "secret_secret",
                    {
                      "color": "#8c564b"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#c49c94"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#7f7f7f"
                    }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#c7c7c7"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "12.0",
              "y": "29.0",
              "width": "6.0",
              "height": "6.0",
              "properties": {
                "title": "Discovery DynamoDB",
                "region": "us-east-1",
                "period": "300.0",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/DynamoDB",
                    "ConsumedReadCapacityUnits",
                    "TableName",
                    "discovery_tenant-config"
                  ],
                  [
                    ".",
                    "ProvisionedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#17becf"
                    }
                  ],
                  [
                    ".",
                    "ConsumedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#aec7e8"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#9edae5"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedReadCapacityUnits",
                    ".",
                    "discovery_collector-config",
                    {
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "ConsumedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#ff7f0e"
                    }
                  ],
                  [
                    ".",
                    "ProvisionedWriteCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#ffbb78"
                    }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    {
                      "color": "#dbdb8d"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "0.0",
              "y": "8.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Inventory Lambda Invocations",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "inventory_api"
                  ],
                  [
                    "...",
                    "inventory_event-broker",
                    {
                      "color": "#17becf"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-consumer",
                    {
                      "color": "#aec7e8"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-indexer",
                    {
                      "color": "#9edae5"
                    }
                  ],
                  [
                    "...",
                    "inventory_resource-retention",
                    {
                      "color": "#98df8a"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "0.0",
              "y": "29.0",
              "width": "12.0",
              "height": "6.0",
              "properties": {
                "title": "Secret API",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Throttles",
                    "FunctionName",
                    "secret_api",
                    {
                      "color": "#d62728"
                    }
                  ],
                  [
                    ".",
                    "Errors",
                    ".",
                    ".",
                    {
                      "color": "#ffbb78"
                    }
                  ],
                  [
                    ".",
                    "Invocations",
                    ".",
                    ".",
                    {
                      "color": "#ff7f0e"
                    }
                  ],
                  [
                    ".",
                    "Duration",
                    ".",
                    ".",
                    {
                      "color": "#ff9896",
                      "stat": "Average"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "0.0",
              "y": "15.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Account Lambda Invocations",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "account_account-sns-publisher",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    "...",
                    "account_account-sync",
                    {
                      "color": "#98df8a"
                    }
                  ],
                  [
                    "...",
                    "account_api",
                    {
                      "color": "#bcbd22"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "9.0",
              "y": "8.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Inventory Lambda Errors and Throttles",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Errors",
                    "FunctionName",
                    "inventory_api"
                  ],
                  [
                    "...",
                    "inventory_event-broker",
                    {
                      "color": "#17becf"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-consumer",
                    {
                      "color": "#aec7e8"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-indexer",
                    {
                      "color": "#9edae5"
                    }
                  ],
                  [
                    "...",
                    "inventory_resource-retention",
                    {
                      "color": "#98df8a"
                    }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    "inventory_api"
                  ],
                  [
                    "...",
                    "inventory_event-broker",
                    {
                      "color": "#17becf"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-consumer",
                    {
                      "color": "#aec7e8"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-indexer",
                    {
                      "color": "#9edae5"
                    }
                  ],
                  [
                    "...",
                    "inventory_resource-retention",
                    {
                      "color": "#98df8a"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "9.0",
              "y": "15.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Account Lambda Errors & Throttles",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Errors",
                    "FunctionName",
                    "account_account-sns-publisher",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    "...",
                    "account_account-sync",
                    {
                      "color": "#98df8a"
                    }
                  ],
                  [
                    "...",
                    "account_api",
                    {
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    "account_account-sns-publisher",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    "...",
                    "account_account-sync",
                    {
                      "color": "#98df8a"
                    }
                  ],
                  [
                    "...",
                    "account_api",
                    {
                      "color": "#bcbd22"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "9.0",
              "y": "22.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Identity Lambda Errors",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Errors",
                    "FunctionName",
                    "identity_tenant-sync",
                    {
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    "...",
                    "identity_orgunit-sync",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    "...",
                    "acp3-identity-sync_identity-auth-sync",
                    {
                      "color": "#17becf"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "9.0",
              "y": "1.0",
              "width": "9.0",
              "height": "6.0",
              "properties": {
                "title": "Discovery Lambda Errors and Throttles",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Errors",
                    "FunctionName",
                    "discovery_api",
                    {
                      "color": "#d62728"
                    }
                  ],
                  [
                    "...",
                    "discovery_collector",
                    {
                      "color": "#e377c2"
                    }
                  ],
                  [
                    "...",
                    "discovery_default-config",
                    {
                      "color": "#ffbb78"
                    }
                  ],
                  [
                    "...",
                    "discovery_diff-engine",
                    {
                      "color": "#f7b6d2"
                    }
                  ],
                  [
                    "...",
                    "discovery_event-adapter",
                    {
                      "color": "#ff9896"
                    }
                  ],
                  [
                    "...",
                    "discovery_publisher",
                    {
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    "discovery_scheduler",
                    {
                      "color": "#c5b0d5"
                    }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    "discovery_api",
                    {
                      "color": "#d62728"
                    }
                  ],
                  [
                    "...",
                    "discovery_collector",
                    {
                      "color": "#e377c2"
                    }
                  ],
                  [
                    "...",
                    "discovery_default-config",
                    {
                      "color": "#ffbb78"
                    }
                  ],
                  [
                    "...",
                    "discovery_diff-engine",
                    {
                      "color": "#f7b6d2"
                    }
                  ],
                  [
                    "...",
                    "discovery_event-adapter",
                    {
                      "color": "#ff9896"
                    }
                  ],
                  [
                    "...",
                    "discovery_publisher",
                    {
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    "discovery_scheduler",
                    {
                      "color": "#c5b0d5"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "18.0",
              "y": "1.0",
              "width": "6.0",
              "height": "6.0",
              "properties": {
                "title": "Discovery Lambda Duration",
                "region": "us-east-1",
                "period": "300.0",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "discovery_api",
                    {
                      "color": "#d62728"
                    }
                  ],
                  [
                    "...",
                    "discovery_collector",
                    {
                      "color": "#e377c2"
                    }
                  ],
                  [
                    "...",
                    "discovery_default-config",
                    {
                      "color": "#ffbb78"
                    }
                  ],
                  [
                    "...",
                    "discovery_diff-engine",
                    {
                      "color": "#f7b6d2"
                    }
                  ],
                  [
                    "...",
                    "discovery_event-adapter",
                    {
                      "color": "#ff9896"
                    }
                  ],
                  [
                    "...",
                    "discovery_publisher",
                    {
                      "color": "#9467bd"
                    }
                  ],
                  [
                    "...",
                    "discovery_scheduler",
                    {
                      "color": "#c5b0d5"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "18.0",
              "y": "8.0",
              "width": "6.0",
              "height": "6.0",
              "properties": {
                "title": "Inventory Lambda Duration",
                "region": "us-east-1",
                "period": "300.0",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "inventory_api"
                  ],
                  [
                    "...",
                    "inventory_event-broker",
                    {
                      "color": "#17becf"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-consumer",
                    {
                      "color": "#aec7e8"
                    }
                  ],
                  [
                    "...",
                    "inventory_event-indexer",
                    {
                      "color": "#9edae5"
                    }
                  ],
                  [
                    "...",
                    "inventory_resource-retention",
                    {
                      "color": "#98df8a"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "18.0",
              "y": "22.0",
              "width": "6.0",
              "height": "6.0",
              "properties": {
                "title": "Identity Lambda Duration",
                "region": "us-east-1",
                "period": "300.0",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "identity_tenant-sync",
                    {
                      "color": "#bcbd22"
                    }
                  ],
                  [
                    "...",
                    "identity_orgunit-sync",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    "...",
                    "acp3-identity-sync_identity-auth-sync",
                    {
                      "color": "#17becf"
                    }
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "18.0",
              "y": "15.0",
              "width": "6.0",
              "height": "6.0",
              "properties": {
                "title": "Account Lambda Duration",
                "region": "us-east-1",
                "period": "300.0",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "account_account-sns-publisher",
                    {
                      "color": "#2ca02c"
                    }
                  ],
                  [
                    "...",
                    "account_account-sync",
                    {
                      "color": "#98df8a"
                    }
                  ],
                  [
                    "...",
                    "account_api",
                    {
                      "color": "#bcbd22"
                    }
                  ]
                ]
              }
            },
            {
              "type": "text",
              "x": "0.0",
              "y": "0.0",
              "width": "24.0",
              "height": "1.0",
              "properties": {
                "markdown": "\\n# Discovery\\n"
              }
            },
            {
              "type": "text",
              "x": "0.0",
              "y": "7.0",
              "width": "24.0",
              "height": "1.0",
              "properties": {
                "markdown": "\\n# Inventory\\n"
              }
            },
            {
              "type": "text",
              "x": "0.0",
              "y": "14.0",
              "width": "24.0",
              "height": "1.0",
              "properties": {
                "markdown": "\\n# Account\\n"
              }
            },
            {
              "type": "text",
              "x": "0.0",
              "y": "21.0",
              "width": "24.0",
              "height": "1.0",
              "properties": {
                "markdown": "\\n# Identity Sync\\n"
              }
            },
            {
              "type": "text",
              "x": "0.0",
              "y": "28.0",
              "width": "12.0",
              "height": "1.0",
              "properties": {
                "markdown": "\\n# Secret API Health\\n"
              }
            },
            {
              "type": "text",
              "x": "12.0",
              "y": "28.0",
              "width": "12.0",
              "height": "1.0",
              "properties": {
                "markdown": "\\n# Discovery & Identity DynamoDB\\n"
              }
            },
            {
              "type": "text",
              "x": "0.0",
              "y": "35.0",
              "width": "24.0",
              "height": "1.0",
              "properties": {
                "markdown": "\\n# External Systems Health\\n"
              }
            },
            {
              "type": "metric",
              "x": "0.0",
              "y": "36.0",
              "width": "12.0",
              "height": "6.0",
              "properties": {
                "title": "AWS Endpoint Latency",
                "region": "us-east-1",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "Discovery/Collector",
                    "Latency",
                    "endpoint",
                    "AWS.ACM.describeCertificate"
                  ],
                  [
                    "...",
                    "AWS.ACM.listCertificates"
                  ],
                  [
                    "...",
                    "AWS.AutoScaling.describeAutoScalingGroups"
                  ],
                  [
                    "...",
                    "AWS.CloudFront.listDistributions"
                  ],
                  [
                    "...",
                    "AWS.CloudTrail.describeTrails"
                  ],
                  [
                    "...",
                    "AWS.CloudTrail.getEventSelectors"
                  ],
                  [
                    "...",
                    "AWS.CloudTrail.getTrailStatus"
                  ],
                  [
                    "...",
                    "AWS.DynamoDB.describeTable"
                  ],
                  [
                    "...",
                    "AWS.DynamoDB.listTables"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeAddresses"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeFlowLogs"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeImages"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeInstances"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeInternetGateways"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeNetworkAcls"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeNetworkInterfaces"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeReservedInstances"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeRouteTables"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeSecurityGroups"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeSnapshots"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeStaleSecurityGroups"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeSubnets"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeVolumes"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeVpcEndpoints"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeVpcPeeringConnections"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeVpcs"
                  ],
                  [
                    "...",
                    "AWS.EC2.describeVpnGateways"
                  ],
                  [
                    "...",
                    "AWS.ELB.describeLoadBalancerAttributes"
                  ],
                  [
                    "...",
                    "AWS.ELB.describeLoadBalancers"
                  ],
                  [
                    "...",
                    "AWS.ELB.describeTags"
                  ],
                  [
                    "...",
                    "AWS.ELBv2.describeListeners"
                  ],
                  [
                    "...",
                    "AWS.ELBv2.describeLoadBalancerAttributes"
                  ],
                  [
                    "...",
                    "AWS.ELBv2.describeLoadBalancers"
                  ],
                  [
                    "...",
                    "AWS.ELBv2.describeTags"
                  ],
                  [
                    "...",
                    "AWS.ELBv2.describeTargetGroups"
                  ],
                  [
                    "...",
                    "AWS.ELBv2.describeTargetHealth"
                  ],
                  [
                    "...",
                    "AWS.ES.describeElasticsearchDomain"
                  ],
                  [
                    "...",
                    "AWS.ES.listDomainNames"
                  ],
                  [
                    "...",
                    "AWS.Glacier.getVaultAccessPolicy"
                  ],
                  [
                    "...",
                    "AWS.Glacier.getVaultLock"
                  ],
                  [
                    "...",
                    "AWS.Glacier.listTagsForVault"
                  ],
                  [
                    "...",
                    "AWS.Glacier.listVaults"
                  ],
                  [
                    "...",
                    "AWS.IAM.generateCredentialReport"
                  ],
                  [
                    "...",
                    "AWS.IAM.getAccountPasswordPolicy"
                  ],
                  [
                    "...",
                    "AWS.IAM.getCredentialReport"
                  ],
                  [
                    "...",
                    "AWS.IAM.getGroupPolicy"
                  ],
                  [
                    "...",
                    "AWS.IAM.getPolicyVersion"
                  ],
                  [
                    "...",
                    "AWS.IAM.getRolePolicy"
                  ],
                  [
                    "...",
                    "AWS.IAM.getUserPolicy"
                  ],
                  [
                    "...",
                    "AWS.IAM.listAttachedGroupPolicies"
                  ],
                  [
                    "...",
                    "AWS.IAM.listAttachedUserPolicies"
                  ],
                  [
                    "...",
                    "AWS.IAM.listEntitiesForPolicy"
                  ],
                  [
                    "...",
                    "AWS.IAM.listGroupPolicies"
                  ],
                  [
                    "...",
                    "AWS.IAM.listGroups"
                  ],
                  [
                    "...",
                    "AWS.IAM.listGroupsForUser"
                  ],
                  [
                    "...",
                    "AWS.IAM.listPolicies"
                  ],
                  [
                    "...",
                    "AWS.IAM.listRolePolicies"
                  ],
                  [
                    "...",
                    "AWS.IAM.listRoles"
                  ],
                  [
                    "...",
                    "AWS.IAM.listServerCertificates"
                  ],
                  [
                    "...",
                    "AWS.IAM.listUserPolicies"
                  ],
                  [
                    "...",
                    "AWS.IAM.listUsers"
                  ],
                  [
                    "...",
                    "AWS.KMS.describeKey"
                  ],
                  [
                    "...",
                    "AWS.KMS.getKeyPolicy"
                  ],
                  [
                    "...",
                    "AWS.KMS.listAliases"
                  ],
                  [
                    "...",
                    "AWS.KMS.listKeys"
                  ],
                  [
                    "...",
                    "AWS.Lambda.getPolicy"
                  ],
                  [
                    "...",
                    "AWS.Lambda.listFunctions"
                  ],
                  [
                    "...",
                    "AWS.RDS.describeDBInstances"
                  ],
                  [
                    "...",
                    "AWS.RDS.describeDBParameterGroups"
                  ],
                  [
                    "...",
                    "AWS.RDS.describeDBParameters"
                  ],
                  [
                    "...",
                    "AWS.RDS.describeDBSecurityGroups"
                  ],
                  [
                    "...",
                    "AWS.RDS.describeDBSnapshotAttributes"
                  ],
                  [
                    "...",
                    "AWS.RDS.describeDBSnapshots"
                  ],
                  [
                    "...",
                    "AWS.RDS.listTagsForResource"
                  ],
                  [
                    "...",
                    "AWS.Redshift.describeClusters"
                  ],
                  [
                    "...",
                    "AWS.Redshift.describeClusterSecurityGroups"
                  ],
                  [
                    "...",
                    "AWS.Redshift.describeClusterSnapshots"
                  ],
                  [
                    "...",
                    "AWS.ResourceGroupsTaggingAPI.getResources"
                  ],
                  [
                    "...",
                    "AWS.Route53Domains.listDomains"
                  ],
                  [
                    "...",
                    "AWS.S3.getBucketAcl"
                  ],
                  [
                    "...",
                    "AWS.S3.getBucketEncryption"
                  ],
                  [
                    "...",
                    "AWS.S3.getBucketLocation"
                  ],
                  [
                    "...",
                    "AWS.S3.getBucketLogging"
                  ],
                  [
                    "...",
                    "AWS.S3.getBucketPolicy"
                  ],
                  [
                    "...",
                    "AWS.S3.getBucketTagging"
                  ],
                  [
                    "...",
                    "AWS.S3.getBucketVersioning"
                  ],
                  [
                    "...",
                    "AWS.S3.listBuckets"
                  ],
                  [
                    "...",
                    "AWS.SNS.getTopicAttributes"
                  ],
                  [
                    "...",
                    "AWS.SNS.listTopics"
                  ],
                  [
                    "...",
                    "AWS.SQS.getQueueAttributes"
                  ],
                  [
                    "...",
                    "AWS.SQS.listQueues"
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "0.0",
              "y": "36.0",
              "width": "12.0",
              "height": "6.0",
              "properties": {
                "title": "Azure Endpoint Latency",
                "region": "us-east-1",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "Discovery/Collector",
                    "Latency",
                    "endpoint",
                    "/providers/Microsoft.Compute/disks?api-version=2017-03-30"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Compute/virtualMachines?api-version=2017-12-01"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Network/networkInterfaces?api-version=2018-01-01"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Network/publicIPAddresses?api-version=2018-01-01"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Network/virtualNetworks?api-version=2018-01-01"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Compute/snapshots?api-version=2017-03-30"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Network/loadBalancers?api-version=2018-04-01"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Compute/images?api-version=2017-12-01"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Storage/storageAccounts?api-version=2017-06-01"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Sql/servers?api-version=2015-05-01-preview"
                  ],
                  [
                    "...",
                    "/providers/Microsoft.Web/sites?api-version=2016-08-01"
                  ],
                  [
                    "...",
                    "/resources?api-version=2018-02-01"
                  ],
                  [
                    "...",
                    "/resourceGroups/{iterator.properties.resourceGroup}/providers/Microsoft.Web/sites/{iterator.name}/functions/?api-version=2016-08-01"
                  ],
                  [
                    "...",
                    "{iterator.id}/blobServices/default/containers?api-version=2018-03-01-preview"
                  ],
                  [
                    "...",
                    "{iterator.id}/databases?api-version=2017-10-01-preview"
                  ],
                  [
                    "...",
                    "{iterator.id}/auditingSettings/default?api-version=2017-03-01-preview"
                  ],
                  [
                    "...",
                    "{iterator.id}/transparentDataEncryption/current?api-version=2014-04-01"
                  ],
                  [
                    "...",
                    "{iterator.id}/connectionPolicies/Default?api-version=2014-04-01-preview"
                  ],
                  [
                    "...",
                    "{iterator.id}/firewallRules?api-version=2014-04-01"
                  ]
                ]
              }
            },
            {
              "type": "metric",
              "x": "12.0",
              "y": "36.0",
              "width": "12.0",
              "height": "6.0",
              "properties": {
                "title": "ACP3 Identity Sync",
                "region": "us-east-1",
                "period": "300.0",
                "stat": "Sum",
                "view": "timeSeries",
                "stacked": "false",
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "acp3-identity-sync_identity-auth-sync",
                    {
                      "color": "#9467bd",
                      "stat": "Average"
                    }
                  ],
                  [
                    ".",
                    "Invocations",
                    ".",
                    ".",
                    {
                      "color": "#e377c2"
                    }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    ".",
                    {
                      "color": "#c5b0d5"
                    }
                  ],
                  [
                    ".",
                    "Errors",
                    ".",
                    ".",
                    {
                      "color": "#f7b6d2"
                    }
                  ]
                ]
              }
            }
          ]
        }
      }
    },
    {
      "type": "aws_cloudwatch_log_group",
      "name": "discovery_diff-engine-log-group",
      "body": {
        "name": "/aws/fargate/discovery_diff-engine"
      }
    },
    {
      "type": "aws_ecs_task_definition",
      "name": "discovery_diff-engine-task-definition",
      "body": {
        "depends_on": [
          "aws_elasticache_replication_group.discovery_cache-replication-group1"
        ],
        "family": "discovery_diff-engine",
        "requires_compatibilities": [
          "FARGATE"
        ],
        "cpu": "256.0",
        "memory": "512.0",
        "network_mode": "awsvpc",
        "task_role_arn": "aws_iam_role.discovery_ecs-diff-engine-role.arn",
        "execution_role_arn": "aws_iam_role.discovery_ecs-execution-role.arn",
        "container_definitions": [
          {
            "name": "discovery_diff-engine",
            "image": "309983114184.dkr.ecr.us-east-1.amazonaws.com/acp-platform-s/discovery_diff-engine:latest",
            "portMappings": [],
            "ulimits": [
              {
                "name": "nofile",
                "hardLimit": "100000.0",
                "softLimit": "100000.0"
              }
            ],
            "environment": [
              {
                "name": "AUTHENTICATION_KEY",
                "value": "discovery_diff-engine_api_key"
              },
              {
                "name": "COMPONENT",
                "value": "discovery"
              },
              {
                "name": "ENV",
                "value": "sandbox1"
              },
              {
                "name": "ENV_BUCKET",
                "value": "acp-platform-s-discovery-sandbox1"
              },
              {
                "name": "FORCE_SCHEMA_CACHE_REFRESH",
                "value": "false"
              },
              {
                "name": "DIFF_ENGINE_OUTPUT_PREFIX",
                "value": "diff-engine"
              },
              {
                "name": "LOG_LEVEL",
                "value": "INFO"
              },
              {
                "name": "REDIS_ADDRESS",
                "value": "${aws_elasticache_replication_group.discovery_cache-replication-group1.primary_endpoint_address}"
              },
              {
                "name": "REDIS_PORT",
                "value": "${aws_elasticache_replication_group.discovery_cache-replication-group1.port}"
              },
              {
                "name": "REDIS_RECORDS_TTL_HOURS",
                "value": "2"
              },
              {
                "name": "QUEUE_URL",
                "value": "${aws_sqs_queue.discovery_diff-engine-queue.id}"
              },
              {
                "name": "PUBLISHER_TOPIC",
                "value": "${aws_sns_topic.discovery_publisher-topic.arn}"
              },
              {
                "name": "SQS_BATCH_SIZE",
                "value": "10"
              },
              {
                "name": "DIFF_ENGINE_ENABLED",
                "value": "true"
              },
              {
                "name": "COMPRESSION_ENABLED",
                "value": "true"
              },
              {
                "name": "S3_PATH_VERSION",
                "value": "13"
              },
              {
                "name": "CONTAINER_MONITOR_INTERVAL",
                "value": "300000"
              },
              {
                "name": "CONTAINER_MONITOR_MESSAGE_AGE_THRESHOLD",
                "value": "450"
              }
            ],
            "logConfiguration": {
              "logDriver": "awslogs",
              "options": {
                "awslogs-group": "/aws/fargate/discovery_diff-engine",
                "awslogs-region": "us-east-1",
                "awslogs-stream-prefix": "/aws/fargate"
              }
            },
            "entryPoint": "null",
            "essential": "true"
          }
        ]
      }
    },
    {
      "type": "aws_ecs_cluster",
      "name": "discovery_platform-s-cluster",
      "body": {
        "name": "acp-platform-s"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-engine-queue-cloudwatch-alaram-messages-high",
      "body": {
        "alarm_name": "discovery_cloudwatch-diff-engine-queue-cloudwatch-alarm-messages-high",
        "alarm_description": "This alarm monitors the number of messages in the discovery_diff-engine-queue for scaling up",
        "comparison_operator": "GreaterThanOrEqualToThreshold",
        "evaluation_periods": "2",
        "metric_name": "ApproximateNumberOfMessagesVisible",
        "namespace": "AWS/SQS",
        "period": "60",
        "statistic": "Average",
        "threshold": "1000",
        "dimensions": {
          "QueueName": "aws_sqs_queue.discovery_diff-engine-queue.name"
        },
        "alarm_actions": [
          "aws_appautoscaling_policy.discovery_diff-engine-autoscaling-up.arn"
        ]
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-engine-queue-cloudwatch-alaram-messages-low",
      "body": {
        "alarm_name": "discovery_diff-engine-queue-cloudwatch-alarm-messages-low",
        "alarm_description": "This alarm monitors the number of messages in the discovery_diff-engine-queue for scaling down",
        "comparison_operator": "LessThanThreshold",
        "evaluation_periods": "1",
        "metric_name": "ApproximateNumberOfMessagesVisible",
        "namespace": "AWS/SQS",
        "period": "60",
        "statistic": "Average",
        "threshold": "1000",
        "dimensions": {
          "QueueName": "aws_sqs_queue.discovery_diff-engine-queue.name"
        },
        "alarm_actions": [
          "aws_appautoscaling_policy.discovery_diff-engine-autoscaling-down.arn"
        ]
      }
    },
    {
      "type": "aws_appautoscaling_target",
      "name": "discovery_diff-engine-autoscaling-target",
      "body": {
        "service_namespace": "ecs",
        "resource_id": "service/${aws_ecs_cluster.discovery_platform-s-cluster.name}/${aws_ecs_service.discovery_diff-engine-service.name}",
        "scalable_dimension": "ecs:service:DesiredCount",
        "role_arn": "aws_iam_role.discovery_ecs-autoscale-role.arn",
        "min_capacity": "1.0",
        "max_capacity": "10.0",
        "depends_on": [
          "aws_ecs_cluster.discovery_platform-s-cluster",
          "aws_ecs_service.discovery_diff-engine-service"
        ]
      }
    },
    {
      "type": "aws_appautoscaling_policy",
      "name": "discovery_diff-engine-autoscaling-up",
      "body": {
        "name": "discovery_diff-engine-autoscaling-up",
        "service_namespace": "ecs",
        "resource_id": "service/${aws_ecs_cluster.discovery_platform-s-cluster.name}/${aws_ecs_service.discovery_diff-engine-service.name}",
        "scalable_dimension": "ecs:service:DesiredCount",
        "step_scaling_policy_configuration": {
          "adjustment_type": "ChangeInCapacity",
          "cooldown": "60.0",
          "metric_aggregation_type": "Average",
          "step_adjustment": {
            "metric_interval_lower_bound": "3000.0",
            "scaling_adjustment": "6.0"
          }
        },
        "depends_on": [
          "aws_appautoscaling_target.discovery_diff-engine-autoscaling-target"
        ]
      }
    },
    {
      "type": "aws_appautoscaling_policy",
      "name": "discovery_diff-engine-autoscaling-down",
      "body": {
        "name": "discovery_diff-engine-autoscaling-down",
        "service_namespace": "ecs",
        "resource_id": "service/${aws_ecs_cluster.discovery_platform-s-cluster.name}/${aws_ecs_service.discovery_diff-engine-service.name}",
        "scalable_dimension": "ecs:service:DesiredCount",
        "step_scaling_policy_configuration": {
          "adjustment_type": "ChangeInCapacity",
          "cooldown": "120.0",
          "metric_aggregation_type": "Average",
          "step_adjustment": {
            "metric_interval_upper_bound": "0.0",
            "scaling_adjustment": "-3.0"
          }
        },
        "depends_on": [
          "aws_appautoscaling_target.discovery_diff-engine-autoscaling-target"
        ]
      }
    },
    {
      "type": "variable",
      "name": "vpc_cidr",
      "body": {
        "description": "CIDR for the whole VPC",
        "default": "10.0.0.0/16"
      }
    },
    {
      "type": "variable",
      "name": "public_subnet_cidr",
      "body": {
        "description": "CIDR for the Public Subnet",
        "default": "10.0.0.0/24"
      }
    },
    {
      "type": "variable",
      "name": "private_subnet_a_cidr",
      "body": {
        "description": "CIDR for the Private Subnet",
        "default": "10.0.64.0/20"
      }
    },
    {
      "type": "variable",
      "name": "private_subnet_b_cidr",
      "body": {
        "description": "CIDR for the Private Subnet",
        "default": "10.0.128.0/20"
      }
    },
    {
      "type": "aws_cloudwatch_log_group",
      "name": "discovery_vpc-flow-log-group",
      "body": {
        "name": "/aws/vpc/discovery_flow-logs"
      }
    },
    {
      "type": "aws_vpc",
      "name": "discovery_vpc",
      "body": {
        "cidr_block": "var.vpc_cidr",
        "instance_tenancy": "default",
        "tags": {
          "Name": "discovery_vpc",
          "Description": "discovery vpc used by Platform.S",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_eip",
      "name": "discovery_nat-gateway-eip",
      "body": {
        "vpc": "true"
      }
    },
    {
      "type": "aws_internet_gateway",
      "name": "discovery_internet-gateway",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "tags": {
          "Name": "discovery_internet-gateway",
          "Description": "discovery internet gateway",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_subnet",
      "name": "discovery_public-subnet",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "cidr_block": "var.public_subnet_cidr",
        "map_public_ip_on_launch": "true",
        "depends_on": [
          "aws_internet_gateway.discovery_internet-gateway"
        ],
        "tags": {
          "Name": "discovery_public-subnet",
          "Description": "discovery vpc public subnet used by Platform.S",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_subnet",
      "name": "discovery_private-subnet-az-a",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "cidr_block": "var.private_subnet_a_cidr",
        "availability_zone": "us-east-1a",
        "tags": {
          "Name": "discovery_private-subnet-az-a",
          "Description": "discovery vpc private subnet a used by Platform.S",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_subnet",
      "name": "discovery_private-subnet-az-b",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "cidr_block": "var.private_subnet_b_cidr",
        "availability_zone": "us-east-1c",
        "tags": {
          "Name": "discovery_private-subnet-az-b",
          "Description": "discovery vpc private subnet b used by Platform.S",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_nat_gateway",
      "name": "discovery_nat-gateway",
      "body": {
        "subnet_id": "aws_subnet.discovery_public-subnet.id",
        "allocation_id": "aws_eip.discovery_nat-gateway-eip.id",
        "depends_on": [
          "aws_subnet.discovery_public-subnet",
          "aws_eip.discovery_nat-gateway-eip",
          "aws_internet_gateway.discovery_internet-gateway"
        ]
      }
    },
    {
      "type": "aws_route_table",
      "name": "discovery_public-route-table",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "tags": {
          "Name": "discovery_public-route-table",
          "Description": "discovery Public Route Table",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_route",
      "name": "discovery_public-route",
      "body": {
        "route_table_id": "aws_route_table.discovery_public-route-table.id",
        "gateway_id": "aws_internet_gateway.discovery_internet-gateway.id",
        "destination_cidr_block": "0.0.0.0/0",
        "depends_on": [
          "aws_internet_gateway.discovery_internet-gateway",
          "aws_route_table.discovery_public-route-table"
        ]
      }
    },
    {
      "type": "aws_route_table",
      "name": "discovery_private-route-table",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "tags": {
          "Name": "discovery_private-route-table",
          "Description": "discovery Private Route Table",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_route",
      "name": "discovery_private-route",
      "body": {
        "route_table_id": "aws_route_table.discovery_private-route-table.id",
        "nat_gateway_id": "aws_nat_gateway.discovery_nat-gateway.id",
        "destination_cidr_block": "0.0.0.0/0",
        "depends_on": [
          "aws_nat_gateway.discovery_nat-gateway",
          "aws_route_table.discovery_private-route-table"
        ]
      }
    },
    {
      "type": "aws_route_table_association",
      "name": "discovery_public-route-table-association",
      "body": {
        "subnet_id": "aws_subnet.discovery_public-subnet.id",
        "route_table_id": "aws_route_table.discovery_public-route-table.id",
        "depends_on": [
          "aws_subnet.discovery_public-subnet",
          "aws_route_table.discovery_public-route-table"
        ]
      }
    },
    {
      "type": "aws_main_route_table_association",
      "name": "discovery_private-route-table-association",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "route_table_id": "aws_route_table.discovery_private-route-table.id",
        "depends_on": [
          "aws_subnet.discovery_private-subnet-az-a",
          "aws_subnet.discovery_private-subnet-az-b",
          "aws_route_table.discovery_private-route-table"
        ]
      }
    },
    {
      "type": "aws_vpc_endpoint",
      "name": "discovery_vpc-endpoint-s3",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "service_name": "com.amazonaws.us-east-1.s3",
        "route_table_ids": [
          "aws_route_table.discovery_public-route-table.id",
          "aws_route_table.discovery_private-route-table.id"
        ]
      }
    },
    {
      "type": "aws_vpc_endpoint",
      "name": "discovery_vpc-endpoint-dynamodb",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "service_name": "com.amazonaws.us-east-1.dynamodb",
        "route_table_ids": [
          "aws_route_table.discovery_public-route-table.id",
          "aws_route_table.discovery_private-route-table.id"
        ]
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_vpc-flow-log-role",
      "body": {
        "name": "discovery_vpc-flow-log-role",
        "assume_role_policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "",
              "Effect": "Allow",
              "Principal": {
                "Service": "vpc-flow-logs.amazonaws.com"
              },
              "Action": "sts:AssumeRole"
            }
          ]
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_vpc-flow-log-policy",
      "body": {
        "name": "discovery_vpc-flow-log-policy",
        "role": "aws_iam_role.discovery_vpc-flow-log-role.id",
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "AllowDescribeLogStreams",
              "Effect": "Allow",
              "Action": [
                "logs:DescribeLogStreams"
              ],
              "Resource": [
                "arn:aws:logs:us-east-1:309983114184:log-group:${aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name}"
              ]
            },
            {
              "Sid": "AllowCreationOfLogStream",
              "Effect": "Allow",
              "Action": [
                "logs:CreateLogStream"
              ],
              "Resource": [
                "arn:aws:logs:us-east-1:309983114184:log-group:${aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name}:*"
              ]
            },
            {
              "Sid": "AllowUploadOfLogEventsToLogStream",
              "Effect": "Allow",
              "Action": [
                "logs:PutLogEvents"
              ],
              "Resource": [
                "arn:aws:logs:us-east-1:309983114184:log-group:${aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name}:*"
              ]
            }
          ]
        }
      }
    },
    {
      "type": "aws_flow_log",
      "name": "discovery_vpc-flow-log",
      "body": {
        "log_group_name": "aws_cloudwatch_log_group.discovery_vpc-flow-log-group.name",
        "iam_role_arn": "aws_iam_role.discovery_vpc-flow-log-role.arn",
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "traffic_type": "ALL"
      }
    },
    {
      "type": "aws_elasticache_subnet_group",
      "name": "discovery_cache-subnet-group1",
      "body": {
        "name": "discovery-cache-subnet-group1",
        "description": "discovery Elasticache Subnet Group",
        "subnet_ids": [
          "aws_subnet.discovery_private-subnet-az-a.id",
          "aws_subnet.discovery_private-subnet-az-b.id"
        ],
        "depends_on": [
          "aws_subnet.discovery_private-subnet-az-a",
          "aws_subnet.discovery_private-subnet-az-b"
        ]
      }
    },
    {
      "type": "aws_security_group",
      "name": "discovery_cache-security-group1",
      "body": {
        "vpc_id": "aws_vpc.discovery_vpc.id",
        "tags": {
          "Name": "discovery_cache-security-group1",
          "Description": "discovery cache security group used by Platform.S",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "depends_on": [
          "aws_vpc.discovery_vpc"
        ],
        "egress": {
          "from_port": "0.0",
          "to_port": "0.0",
          "protocol": "-1",
          "cidr_blocks": [
            "0.0.0.0/0"
          ]
        },
        "ingress": {
          "from_port": "0.0",
          "to_port": "0.0",
          "protocol": "-1",
          "self": "true"
        }
      }
    },
    {
      "type": "aws_iam_policy_document",
      "name": "discovery_ecs-execution-policy",
      "body": {
        "statement": {
          "actions": [
            "sts:AssumeRole"
          ],
          "principals": {
            "type": "Service",
            "identifiers": [
              "ecs-tasks.amazonaws.com"
            ]
          }
        }
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_ecs-execution-role",
      "body": {
        "name": "discovery_ecs-execution-role",
        "path": "/",
        "assume_role_policy": "data.aws_iam_policy_document.discovery_ecs-execution-policy.json"
      }
    },
    {
      "type": "aws_iam_role_policy_attachment",
      "name": "discovery_ecs-task-execution-policy",
      "body": {
        "role": "aws_iam_role.discovery_ecs-execution-role.name",
        "policy_arn": "arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy"
      }
    },
    {
      "type": "aws_iam_policy_document",
      "name": "discovery_ecs-autoscale-policy",
      "body": {
        "statement": {
          "actions": [
            "sts:AssumeRole"
          ],
          "principals": {
            "type": "Service",
            "identifiers": [
              "ecs-tasks.amazonaws.com"
            ]
          }
        }
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_ecs-autoscale-role",
      "body": {
        "name": "discovery_ecs-autoscale-role",
        "assume_role_policy": "data.aws_iam_policy_document.discovery_ecs-autoscale-policy.json"
      }
    },
    {
      "type": "aws_iam_policy_attachment",
      "name": "discovery_ecs-autoscale-policy",
      "body": {
        "name": "discovery_ecs-autoscale-policy",
        "roles": [
          "aws_iam_role.discovery_ecs-autoscale-role.name"
        ],
        "policy_arn": "arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceAutoscaleRole"
      }
    },
    {
      "type": "aws_cloudwatch_log_group",
      "name": "discovery_collector-log-group",
      "body": {
        "name": "/aws/fargate/discovery_collector"
      }
    },
    {
      "type": "aws_ecs_task_definition",
      "name": "discovery_collector-task-definition",
      "body": {
        "depends_on": [
          "aws_elasticache_replication_group.discovery_cache-replication-group1"
        ],
        "family": "discovery_collector",
        "requires_compatibilities": [
          "FARGATE"
        ],
        "cpu": "256.0",
        "memory": "512.0",
        "network_mode": "awsvpc",
        "task_role_arn": "aws_iam_role.discovery_ecs-collector-role.arn",
        "execution_role_arn": "aws_iam_role.discovery_ecs-execution-role.arn",
        "container_definitions": [
          {
            "name": "discovery_collector",
            "image": "309983114184.dkr.ecr.us-east-1.amazonaws.com/acp-platform-s/discovery_collector:latest",
            "portMappings": [],
            "ulimits": [
              {
                "name": "nofile",
                "hardLimit": "100000.0",
                "softLimit": "100000.0"
              }
            ],
            "environment": [
              {
                "name": "COMPONENT",
                "value": "discovery"
              },
              {
                "name": "ENV",
                "value": "sandbox1"
              },
              {
                "name": "ENV_BUCKET",
                "value": "acp-platform-s-discovery-sandbox1"
              },
              {
                "name": "COLLECTOR_OUTPUT_PREFIX",
                "value": "discovered-resources"
              },
              {
                "name": "CONTAINER_MONITOR_INTERVAL",
                "value": "300000"
              },
              {
                "name": "CONTAINER_MONITOR_MESSAGE_AGE_THRESHOLD",
                "value": "450"
              },
              {
                "name": "AUTHENTICATION_KEY",
                "value": "discovery_collector_api_key"
              },
              {
                "name": "LOG_LEVEL",
                "value": "INFO"
              },
              {
                "name": "REDIS_ADDRESS",
                "value": "${aws_elasticache_replication_group.discovery_cache-replication-group1.primary_endpoint_address}"
              },
              {
                "name": "REDIS_PORT",
                "value": "${aws_elasticache_replication_group.discovery_cache-replication-group1.port}"
              },
              {
                "name": "REDIS_RECORDS_TTL_HOURS",
                "value": "2"
              },
              {
                "name": "S3_CONCURRENT_UPLOADS",
                "value": "20"
              },
              {
                "name": "S3_PART_SIZE_MB",
                "value": "5"
              },
              {
                "name": "QUEUE_URL",
                "value": "${aws_sqs_queue.discovery_collector-queue.id}"
              },
              {
                "name": "SQS_BATCH_SIZE",
                "value": "10"
              },
              {
                "name": "COLLECTOR_ENABLED",
                "value": "true"
              },
              {
                "name": "STUB_MODE",
                "value": "false"
              },
              {
                "name": "STUB_RANDOM_DELAY",
                "value": "false"
              },
              {
                "name": "STUB_THROTTLE_ERRORS",
                "value": "false"
              },
              {
                "name": "STUB_HANDLER_ERRORS",
                "value": "false"
              },
              {
                "name": "CW_DETAILED_METRICS",
                "value": "false"
              },
              {
                "name": "COMPRESSION_ENABLED",
                "value": "true"
              },
              {
                "name": "PROMISE_POOL_CONCURRENCY",
                "value": "10"
              },
              {
                "name": "DISCOVERY_TOPIC",
                "value": "${aws_sns_topic.discovery_scheduled-discovery-topic.arn}"
              },
              {
                "name": "REDIS_TOKEN_CACHE_KEY_TTL_SECONDS",
                "value": "3480"
              },
              {
                "name": "FORCE_GOOGLE_CREDENTIAL_CACHE_REFRESH",
                "value": "true"
              }
            ],
            "logConfiguration": {
              "logDriver": "awslogs",
              "options": {
                "awslogs-group": "/aws/fargate/discovery_collector",
                "awslogs-region": "us-east-1",
                "awslogs-stream-prefix": "/aws/fargate"
              }
            },
            "entryPoint": "null",
            "essential": "true"
          }
        ]
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_ecs-collector-role",
      "body": {
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_ecs-collector-role",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com"
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_ecs-collector-role"
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_ecs-collector-role_role_policy",
      "body": {
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:us-east-1:309983114184:log-group:discovery:log-stream:*"
              ]
            },
            {
              "Action": [
                "cloudwatch:PutMetricData",
                "cloudwatch:GetMetricStatistics"
              ],
              "Effect": "Allow",
              "Resource": [
                "*"
              ]
            },
            {
              "Action": [
                "sqs:DeleteMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:DeleteMessageBatch",
                "sqs:ChangeMessageVisibilityBatch",
                "sqs:ReceiveMessage"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_collector-queue.arn}",
                "${aws_sqs_queue.discovery_collector-deadletter-queue.arn}"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "s3:PutObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/*"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/env/*",
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/component-test/*",
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/throttleCollector/*",
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/container-env-vars/collector.json"
              ]
            },
            {
              "Action": [
                "s3:DeleteObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/*"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "sns:Publish"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:sns:us-east-1:309983114184:discovery_scheduled-discovery-topic"
              ]
            },
            {
              "Action": [
                "ec2:Describe*"
              ],
              "Effect": "Allow",
              "Resource": [
                "*"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKeyWithoutPlaintext",
                "kms:Encrypt",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:kms:us-east-1:309983114184:key/${aws_kms_key.discovery_cache-master-key.key_id}"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_ecs-collector-role.id",
        "name": "discovery_ecs-collector-role_role_policy"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_ecs-diff-engine-role",
      "body": {
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_ecs-diff-engine-role",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com"
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_ecs-diff-engine-role"
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_ecs-diff-engine-role_role_policy",
      "body": {
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:us-east-1:309983114184:log-group:discovery:log-stream:*"
              ]
            },
            {
              "Action": [
                "cloudwatch:PutMetricData",
                "cloudwatch:GetMetricStatistics"
              ],
              "Effect": "Allow",
              "Resource": [
                "*"
              ]
            },
            {
              "Action": [
                "sqs:DeleteMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:DeleteMessageBatch",
                "sqs:ChangeMessageVisibilityBatch",
                "sqs:ReceiveMessage"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_diff-engine-queue.arn}",
                "${aws_sqs_queue.discovery_diff-engine-deadletter-queue.arn}"
              ]
            },
            {
              "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:GetObjectTagging",
                "s3:PutObjectTagging"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/*"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/container-env-vars/diff-engine.json"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "sns:Publish"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:sns:us-east-1:309983114184:discovery_publisher-topic"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_ecs-diff-engine-role.id",
        "name": "discovery_ecs-diff-engine-role_role_policy"
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_aws-discovery-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_aws-discovery-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_aws-discovery-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_collector-queue",
      "body": {
        "visibility_timeout_seconds": "30.0",
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_collector-queue",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "policy": {
          "Version": "2012-10-17",
          "Id": "arn:aws:sqs:us-east-1:309983114184:discovery_collector-queue/SNStoSQSPolicy",
          "Statement": [
            {
              "Sid": "",
              "Effect": "Allow",
              "Principal": {
                "AWS": "*"
              },
              "Action": "SQS:SendMessage",
              "Resource": "arn:aws:sqs:us-east-1:309983114184:discovery_collector-queue",
              "Condition": {
                "ArnEquals": {
                  "aws:SourceArn": "arn:aws:sns:us-east-1:309983114184:discovery_scheduled-discovery-topic"
                }
              }
            }
          ]
        },
        "kms_data_key_reuse_period_seconds": "3600.0",
        "redrive_policy": {
          "deadLetterTargetArn": "${aws_sqs_queue.discovery_collector-deadletter-queue.arn}",
          "maxReceiveCount": "2.0"
        },
        "message_retention_seconds": "3600.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-queue",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_diff-engine-queue",
      "body": {
        "visibility_timeout_seconds": "30.0",
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_diff-engine-queue",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "policy": {
          "Version": "2012-10-17",
          "Id": "arn:aws:sqs:us-east-1:309983114184:discovery_diff-engine-queue/SNStoSQSPolicy",
          "Statement": [
            {
              "Sid": "",
              "Effect": "Allow",
              "Principal": {
                "AWS": "*"
              },
              "Action": "SQS:SendMessage",
              "Resource": "arn:aws:sqs:us-east-1:309983114184:discovery_diff-engine-queue",
              "Condition": {
                "ArnEquals": {
                  "aws:SourceArn": "arn:aws:sns:us-east-1:309983114184:discovery_diff-engine-topic"
                }
              }
            }
          ]
        },
        "kms_data_key_reuse_period_seconds": "3600.0",
        "redrive_policy": {
          "deadLetterTargetArn": "${aws_sqs_queue.discovery_diff-engine-deadletter-queue.arn}",
          "maxReceiveCount": "2.0"
        },
        "message_retention_seconds": "3600.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-engine-queue",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_publisher-queue",
      "body": {
        "visibility_timeout_seconds": "120.0",
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_publisher-queue",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "policy": {
          "Version": "2012-10-17",
          "Id": "arn:aws:sqs:us-east-1:309983114184:discovery_publisher-queue/SNStoSQSPolicy",
          "Statement": [
            {
              "Sid": "",
              "Effect": "Allow",
              "Principal": {
                "AWS": "*"
              },
              "Action": "SQS:SendMessage",
              "Resource": "arn:aws:sqs:us-east-1:309983114184:discovery_publisher-queue",
              "Condition": {
                "ArnEquals": {
                  "aws:SourceArn": "arn:aws:sns:us-east-1:309983114184:discovery_publisher-topic"
                }
              }
            }
          ]
        },
        "kms_data_key_reuse_period_seconds": "3600.0",
        "redrive_policy": {
          "deadLetterTargetArn": "${aws_sqs_queue.discovery_publisher-deadletter-queue.arn}",
          "maxReceiveCount": "2.0"
        },
        "message_retention_seconds": "3600.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher-queue",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_consistency-checker-queue",
      "body": {
        "delay_seconds": "900.0",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "3600.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-checker-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_consistency-checker-queue",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "visibility_timeout_seconds": "60.0",
        "policy": {
          "Version": "2012-10-17",
          "Id": "arn:aws:sqs:us-east-1:309983114184:discovery_consistency-checker-queue/SNStoSQSPolicy",
          "Statement": [
            {
              "Sid": "",
              "Effect": "Allow",
              "Principal": {
                "AWS": "*"
              },
              "Action": "SQS:SendMessage",
              "Resource": "arn:aws:sqs:us-east-1:309983114184:discovery_consistency-checker-queue",
              "Condition": {
                "ArnEquals": {
                  "aws:SourceArn": "arn:aws:sns:us-east-1:309983114184:discovery_publisher-topic"
                }
              }
            }
          ]
        },
        "redrive_policy": {
          "deadLetterTargetArn": "${aws_sqs_queue.discovery_consistency-checker-deadletter-queue.arn}",
          "maxReceiveCount": "2.0"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_decommission-queue",
      "body": {
        "visibility_timeout_seconds": "300.0",
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "delay_seconds": "900.0",
        "name": "discovery_decommission-queue",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "kms_data_key_reuse_period_seconds": "3600.0",
        "redrive_policy": {
          "deadLetterTargetArn": "${aws_sqs_queue.discovery_decommission-deadletter-queue.arn}",
          "maxReceiveCount": "2.0"
        },
        "message_retention_seconds": "3600.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission-queue",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_provider-consistency-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_provider-consistency-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "3600.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "visibility_timeout_seconds": "300.0",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "redrive_policy": {
          "deadLetterTargetArn": "${aws_sqs_queue.discovery_provider-consistency-deadletter-queue.arn}",
          "maxReceiveCount": "2.0"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_provider-consistency-deadletter-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_provider-consistency-deadletter-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "604800.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-deadletter-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_consistency-checker-deadletter-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_consistency-checker-deadletter-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "604800.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-checker-deadletter-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_collector-deadletter-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_collector-deadletter-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "604800.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-deadletter-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_diff-engine-deadletter-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_diff-engine-deadletter-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "604800.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-engine-deadletter-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_publisher-deadletter-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_publisher-deadletter-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "604800.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher-deadletter-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_sqs_queue",
      "name": "discovery_decommission-deadletter-queue",
      "body": {
        "kms_master_key_id": "aws_kms_key.discovery_master-key.arn",
        "name": "discovery_decommission-deadletter-queue",
        "kms_data_key_reuse_period_seconds": "3600.0",
        "message_retention_seconds": "604800.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission-deadletter-queue",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "lifecycle": {
          "prevent_destroy": "true"
        }
      }
    },
    {
      "type": "aws_sns_topic",
      "name": "discovery_scheduled-discovery-topic",
      "body": {
        "name": "discovery_scheduled-discovery-topic"
      }
    },
    {
      "type": "aws_sns_topic_subscription",
      "name": "discovery_scheduled-discovery-topic_Sub_sqs_discovery_collector-queue",
      "body": {
        "protocol": "sqs",
        "endpoint": "aws_sqs_queue.discovery_collector-queue.arn",
        "topic_arn": "aws_sns_topic.discovery_scheduled-discovery-topic.arn"
      }
    },
    {
      "type": "aws_sns_topic",
      "name": "discovery_s3-notification-topic",
      "body": {
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": "SNS:Publish",
              "Resource": "arn:aws:sns:*:*:discovery_s3-notification-topic",
              "Effect": "Allow",
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
                }
              },
              "Principal": {
                "Service": "s3.amazonaws.com"
              }
            }
          ]
        },
        "name": "discovery_s3-notification-topic"
      }
    },
    {
      "type": "aws_sns_topic",
      "name": "discovery_events-topic",
      "body": {
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": "SNS:Publish",
              "Resource": "arn:aws:sns:*:*:discovery_events-topic",
              "Effect": "Allow",
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
                }
              },
              "Principal": {
                "Service": "s3.amazonaws.com"
              }
            }
          ]
        },
        "name": "discovery_events-topic"
      }
    },
    {
      "type": "aws_sns_topic",
      "name": "discovery_diff-engine-topic",
      "body": {
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": "SNS:Publish",
              "Resource": "arn:aws:sns:*:*:discovery_diff-engine-topic",
              "Effect": "Allow",
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
                }
              },
              "Principal": {
                "Service": "s3.amazonaws.com"
              }
            }
          ]
        },
        "name": "discovery_diff-engine-topic"
      }
    },
    {
      "type": "aws_sns_topic_subscription",
      "name": "discovery_diff-engine-topic_Sub_sqs_discovery_diff-engine-queue",
      "body": {
        "protocol": "sqs",
        "endpoint": "aws_sqs_queue.discovery_diff-engine-queue.arn",
        "topic_arn": "aws_sns_topic.discovery_diff-engine-topic.arn"
      }
    },
    {
      "type": "aws_sns_topic",
      "name": "discovery_publisher-topic",
      "body": {
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": "SNS:Publish",
              "Resource": "arn:aws:sns:*:*:discovery_publisher-topic",
              "Effect": "Allow",
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
                }
              },
              "Principal": {
                "Service": "s3.amazonaws.com"
              }
            }
          ]
        },
        "name": "discovery_publisher-topic"
      }
    },
    {
      "type": "aws_sns_topic_subscription",
      "name": "discovery_publisher-topic_Sub_sqs_discovery_publisher-queue",
      "body": {
        "protocol": "sqs",
        "endpoint": "aws_sqs_queue.discovery_publisher-queue.arn",
        "topic_arn": "aws_sns_topic.discovery_publisher-topic.arn"
      }
    },
    {
      "type": "aws_sns_topic_subscription",
      "name": "discovery_publisher-topic_Sub_sqs_discovery_consistency-checker-queue",
      "body": {
        "protocol": "sqs",
        "endpoint": "aws_sqs_queue.discovery_consistency-checker-queue.arn",
        "topic_arn": "aws_sns_topic.discovery_publisher-topic.arn"
      }
    },
    {
      "type": "aws_sns_topic",
      "name": "discovery_provider-inconsistency-topic",
      "body": {
        "name": "discovery_provider-inconsistency-topic"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_agent-status_ReadThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables ReadThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_agent-status"
        },
        "alarm_name": "discovery_agent-status_ReadThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_agent-status_ReadThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "ReadThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_agent-status_WriteThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables WriteThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_agent-status"
        },
        "alarm_name": "discovery_agent-status_WriteThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_agent-status_WriteThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "WriteThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_dynamodb_table",
      "name": "discovery_agent-status",
      "body": {
        "point_in_time_recovery": {
          "enabled": "true"
        },
        "read_capacity": "1.0",
        "hash_key": "TenantId",
        "name": "discovery_agent-status",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "write_capacity": "1.0",
        "range_key": "AgentId",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_agent-status",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "attribute": {
          "name": "AgentId",
          "type": "S"
        }
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_tenant-config_ReadThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables ReadThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_tenant-config"
        },
        "alarm_name": "discovery_tenant-config_ReadThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_tenant-config_ReadThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "ReadThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_tenant-config_WriteThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables WriteThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_tenant-config"
        },
        "alarm_name": "discovery_tenant-config_WriteThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_tenant-config_WriteThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "WriteThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_dynamodb_table",
      "name": "discovery_tenant-config",
      "body": {
        "point_in_time_recovery": {
          "enabled": "true"
        },
        "read_capacity": "15.0",
        "hash_key": "tenantId",
        "name": "discovery_tenant-config",
        "lifecycle": {
          "prevent_destroy": "false"
        },
        "write_capacity": "10.0",
        "range_key": "accountId",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_tenant-config",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "attribute": {
          "name": "accountId",
          "type": "S"
        }
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_collector-config_ReadThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables ReadThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_collector-config"
        },
        "alarm_name": "discovery_collector-config_ReadThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-config_ReadThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "ReadThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_collector-config_WriteThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables WriteThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_collector-config"
        },
        "alarm_name": "discovery_collector-config_WriteThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-config_WriteThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "WriteThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_dynamodb_table",
      "name": "discovery_collector-config",
      "body": {
        "point_in_time_recovery": {
          "enabled": "true"
        },
        "read_capacity": "5.0",
        "hash_key": "provider",
        "name": "discovery_collector-config",
        "lifecycle": {
          "prevent_destroy": "false"
        },
        "write_capacity": "3.0",
        "range_key": "resourceType",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-config",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "attribute": {
          "name": "resourceType",
          "type": "S"
        }
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_consistency-data_ReadThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables ReadThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_consistency-data"
        },
        "alarm_name": "discovery_consistency-data_ReadThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-data_ReadThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "ReadThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_consistency-data_WriteThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables WriteThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_consistency-data"
        },
        "alarm_name": "discovery_consistency-data_WriteThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-data_WriteThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "WriteThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_dynamodb_table",
      "name": "discovery_consistency-data",
      "body": {
        "point_in_time_recovery": {
          "enabled": "true"
        },
        "read_capacity": "1.0",
        "hash_key": "resourceType",
        "name": "discovery_consistency-data",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "write_capacity": "1.0",
        "range_key": "id",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-data",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "attribute": {
          "name": "id",
          "type": "S"
        }
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_provider-consistency_ReadThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables ReadThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_provider-consistency"
        },
        "alarm_name": "discovery_provider-consistency_ReadThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency_ReadThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "ReadThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_provider-consistency_WriteThrottleEvents_capacityAlarm",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual tables WriteThrottleEvents",
        "period": "60.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "TableName": "discovery_provider-consistency"
        },
        "alarm_name": "discovery_provider-consistency_WriteThrottleEvents_capacityAlarm",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency_WriteThrottleEvents_capacityAlarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "WriteThrottleEvents",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/DynamoDB",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_dynamodb_table",
      "name": "discovery_provider-consistency",
      "body": {
        "point_in_time_recovery": {
          "enabled": "true"
        },
        "read_capacity": "1.0",
        "ttl": {
          "attribute_name": "expirationTime",
          "enabled": "true"
        },
        "hash_key": "provider",
        "name": "discovery_provider-consistency",
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "attribute": {
          "name": "id",
          "type": "S"
        },
        "write_capacity": "1.0",
        "range_key": "id",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_api_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_api_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_api_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_api_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_api_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_api*"
              ]
            },
            {
              "Action": [
                "dynamodb:Query"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_account-executions/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_account-executions"
              ]
            },
            {
              "Action": [
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:BatchGetItem"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_executions/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_executions"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token"
              ]
            },
            {
              "Action": [
                "dynamodb:Query"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:UpdateItem",
                "dynamodb:Scan"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "ec2:CreateNetworkInterface",
                "ec2:DescribeNetworkInterfaces",
                "ec2:DetachNetworkInterface",
                "ec2:DeleteNetworkInterface"
              ],
              "Effect": "Allow",
              "Resource": [
                "*"
              ]
            },
            {
              "Action": [
                "ec2:CreateNetworkInterface",
                "ec2:DescribeNetworkInterfaces",
                "ec2:DeleteNetworkInterface"
              ],
              "Effect": "Allow",
              "Resource": [
                "*"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_api_role.id",
        "name": "discovery_api_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_api_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_api"
        },
        "alarm_name": "discovery_api_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "300.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_api_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_api_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_api"
        },
        "alarm_name": "discovery_api_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_api_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_api",
      "body": {
        "function_name": "discovery_api",
        "depends_on": [
          "aws_iam_role.discovery_api_role"
        ],
        "role": "aws_iam_role.discovery_api_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_api",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "timeout": "30.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "vpc_config": {
          "subnet_ids": [
            "aws_subnet.discovery_private-subnet-az-a.id",
            "aws_subnet.discovery_private-subnet-az-b.id"
          ],
          "security_group_ids": [
            "aws_security_group.discovery_cache-security-group1.id"
          ]
        },
        "memory_size": "768.0",
        "runtime": "nodejs8.10",
        "description": "Discovery API"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_container-config_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_container-config_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_container-config_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_container-config_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_container-config_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_container-config*"
              ]
            },
            {
              "Action": [
                "s3:PutObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/container-env-vars/*"
              ]
            },
            {
              "Action": [
                "ec2:CreateNetworkInterface",
                "ec2:DescribeNetworkInterfaces",
                "ec2:DeleteNetworkInterface"
              ],
              "Effect": "Allow",
              "Resource": [
                "*"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_container-config_role.id",
        "name": "discovery_container-config_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_container-config_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_container-config"
        },
        "alarm_name": "discovery_container-config_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "10.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_container-config_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_container-config_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_container-config"
        },
        "alarm_name": "discovery_container-config_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_container-config_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_container-config",
      "body": {
        "function_name": "discovery_container-config",
        "depends_on": [
          "aws_iam_role.discovery_container-config_role"
        ],
        "role": "aws_iam_role.discovery_container-config_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_container-config",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "timeout": "30.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "vpc_config": {
          "subnet_ids": [
            "aws_subnet.discovery_private-subnet-az-a.id",
            "aws_subnet.discovery_private-subnet-az-b.id"
          ],
          "security_group_ids": [
            "aws_security_group.discovery_cache-security-group1.id"
          ]
        },
        "memory_size": "512.0",
        "runtime": "nodejs8.10",
        "description": "Discovery container config redis publisher"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_scheduler_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_scheduler_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_scheduler_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_scheduler_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_scheduler_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_scheduler*"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_collector-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_collector-config",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "sns:Publish"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:sns:us-east-1:309983114184:discovery_scheduled-discovery-topic"
              ]
            },
            {
              "Action": [
                "events:DescribeRule"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:events:us-east-1:309983114184:rule/discovery_scheduler-rule"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_scheduler_role.id",
        "name": "discovery_scheduler_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_scheduler_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_scheduler"
        },
        "alarm_name": "discovery_scheduler_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "100.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_scheduler_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_scheduler_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_scheduler"
        },
        "alarm_name": "discovery_scheduler_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_scheduler_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_scheduler",
      "body": {
        "function_name": "discovery_scheduler",
        "depends_on": [
          "aws_iam_role.discovery_scheduler_role"
        ],
        "role": "aws_iam_role.discovery_scheduler_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_scheduler",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "memory_size": "1280.0",
        "timeout": "180.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "runtime": "nodejs8.10",
        "description": "Scheduler which will start a discovery run."
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_legacy-scheduler_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_legacy-scheduler_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_legacy-scheduler_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_legacy-scheduler_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_legacy-scheduler_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_legacy-scheduler*"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_collector-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_collector-config",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "sns:Publish"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:sns:us-east-1:309983114184:discovery_scheduled-discovery-topic"
              ]
            },
            {
              "Action": [
                "events:DescribeRule"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:events:us-east-1:309983114184:rule/discovery_legacy-scheduler-rule"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_legacy-scheduler_role.id",
        "name": "discovery_legacy-scheduler_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_legacy-scheduler_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_legacy-scheduler"
        },
        "alarm_name": "discovery_legacy-scheduler_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "100.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_legacy-scheduler_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_legacy-scheduler_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_legacy-scheduler"
        },
        "alarm_name": "discovery_legacy-scheduler_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_legacy-scheduler_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_legacy-scheduler",
      "body": {
        "function_name": "discovery_legacy-scheduler",
        "depends_on": [
          "aws_iam_role.discovery_legacy-scheduler_role"
        ],
        "role": "aws_iam_role.discovery_legacy-scheduler_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_legacy-scheduler",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "memory_size": "512.0",
        "timeout": "180.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "runtime": "nodejs8.10",
        "description": "Scheduler which will start a discovery run using old batching logic."
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_publisher_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_publisher_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_publisher_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_publisher_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_publisher*"
              ]
            },
            {
              "Action": [
                "s3:PutObject",
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/*"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "sqs:GetQueueAttributes",
                "sqs:DeleteMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:DeleteMessageBatch",
                "sqs:ChangeMessageVisibilityBatch",
                "sqs:ReceiveMessage"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_publisher-queue.arn}",
                "${aws_sqs_queue.discovery_publisher-deadletter-queue.arn}"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            },
            {
              "Action": [
                "sns:Publish"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:sns:us-east-1:309983114184:discovery_events-topic"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_publisher_role.id",
        "name": "discovery_publisher_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_publisher_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_publisher"
        },
        "alarm_name": "discovery_publisher_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "1300.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_publisher_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_publisher"
        },
        "alarm_name": "discovery_publisher_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_publisher",
      "body": {
        "function_name": "discovery_publisher",
        "depends_on": [
          "aws_iam_role.discovery_publisher_role"
        ],
        "role": "aws_iam_role.discovery_publisher_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "timeout": "120.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "memory_size": "2650.0",
        "runtime": "nodejs8.10",
        "description": "Sends changed resources as domain S3 events to the publisher bucket."
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_event-adapter_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_event-adapter_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-adapter_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_event-adapter_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_event-adapter_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_event-adapter*"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/publisher/*",
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/throttled-collector-publisher/*"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "kinesis:PutRecord"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kinesis_stream.discovery_event-bus.arn}"
              ]
            },
            {
              "Action": [
                "kinesis:PutRecords"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kinesis_stream.discovery_event-bus.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_event-adapter_role.id",
        "name": "discovery_event-adapter_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_event-adapter_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_event-adapter"
        },
        "alarm_name": "discovery_event-adapter_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "1300.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-adapter_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_event-adapter_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_event-adapter"
        },
        "alarm_name": "discovery_event-adapter_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-adapter_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_event-adapter",
      "body": {
        "function_name": "discovery_event-adapter",
        "depends_on": [
          "aws_iam_role.discovery_event-adapter_role"
        ],
        "role": "aws_iam_role.discovery_event-adapter_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-adapter",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "timeout": "60.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "memory_size": "1024.0",
        "runtime": "nodejs8.10",
        "description": "Adapts publisher s3 notifications into kinesis events and sends to discovery_event-bus."
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_default-config_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_default-config_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_default-config_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_default-config_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_default-config_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_default-config*"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan",
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:DeleteItem",
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_default-config_role.id",
        "name": "discovery_default-config_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_default-config_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_default-config"
        },
        "alarm_name": "discovery_default-config_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "500.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_default-config_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_default-config_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_default-config"
        },
        "alarm_name": "discovery_default-config_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_default-config_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_default-config",
      "body": {
        "function_name": "discovery_default-config",
        "depends_on": [
          "aws_iam_role.discovery_default-config_role"
        ],
        "role": "aws_iam_role.discovery_default-config_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_default-config",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "timeout": "240.0",
        "memory_size": "128.0",
        "runtime": "nodejs8.10",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "description": "Creates the default discovery config for all new tenants"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_default-config_account_account-topic_sns_invoke_lambda_permission",
      "body": {
        "statement_id": "discovery_default-config_account_account-topic_sns_invoke_lambda_permission",
        "depends_on": [
          "aws_lambda_function.discovery_default-config"
        ],
        "source_arn": "arn:aws:sns:us-east-1:309983114184:account_account-topic",
        "action": "lambda:InvokeFunction",
        "function_name": "aws_lambda_function.discovery_default-config.arn",
        "principal": "sns.amazonaws.com"
      }
    },
    {
      "type": "aws_sns_topic_subscription",
      "name": "discovery_default-config_Sub_account_account-topic",
      "body": {
        "depends_on": [
          "aws_lambda_function.discovery_default-config"
        ],
        "topic_arn": "arn:aws:sns:us-east-1:309983114184:account_account-topic",
        "endpoint": "aws_lambda_function.discovery_default-config.arn",
        "protocol": "lambda"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_diff-tagging_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_diff-tagging_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-tagging_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_diff-tagging_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_diff-tagging_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_diff-tagging*"
              ]
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:GetObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:PutObjectTagging"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/diff-engine/*"
              ]
            },
            {
              "Action": [
                "s3:PutObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/diff-tagging-failures/*"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "kinesis:GetRecords",
                "kinesis:GetShardIterator",
                "kinesis:DescribeStream",
                "kinesis:ListStreams"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:kinesis:us-east-1:309983114184:stream/discovery_event-bus"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_diff-tagging_role.id",
        "name": "discovery_diff-tagging_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-tagging_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_diff-tagging"
        },
        "alarm_name": "discovery_diff-tagging_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "320.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-tagging_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-tagging_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_diff-tagging"
        },
        "alarm_name": "discovery_diff-tagging_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-tagging_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_diff-tagging",
      "body": {
        "function_name": "discovery_diff-tagging",
        "depends_on": [
          "aws_iam_role.discovery_diff-tagging_role"
        ],
        "role": "aws_iam_role.discovery_diff-tagging_role.arn",
        "memory_size": "1280.0",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-tagging",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "timeout": "120.0",
        "runtime": "nodejs8.10",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "description": "Consume kinesis events and tag the diff file to indicate discovery changes have been published"
      }
    },
    {
      "type": "aws_lambda_event_source_mapping",
      "name": "discovery_diff-tagging_EvtMap_discovery_event-bus",
      "body": {
        "depends_on": [
          "aws_lambda_function.discovery_diff-tagging"
        ],
        "starting_position": "LATEST",
        "batch_size": "50.0",
        "event_source_arn": "arn:aws:kinesis:us-east-1:309983114184:stream/discovery_event-bus",
        "function_name": "discovery_diff-tagging"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_consistency-checker_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_consistency-checker_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-checker_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_consistency-checker_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_consistency-checker_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_consistency-checker*"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:DeleteItem",
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_consistency-data/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_consistency-data"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_provider-consistency/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_provider-consistency"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/diff-engine/*"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/consistency/*"
              ]
            },
            {
              "Action": [
                "s3:PutObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/consistency/*"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/env/*"
              ]
            },
            {
              "Action": [
                "sqs:GetQueueAttributes",
                "sqs:DeleteMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:DeleteMessageBatch",
                "sqs:ChangeMessageVisibilityBatch",
                "sqs:ReceiveMessage"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_consistency-checker-queue.arn}",
                "${aws_sqs_queue.discovery_consistency-checker-deadletter-queue.arn}"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_consistency-checker_role.id",
        "name": "discovery_consistency-checker_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_consistency-checker_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_consistency-checker"
        },
        "alarm_name": "discovery_consistency-checker_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "1500.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-checker_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_consistency-checker_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_consistency-checker"
        },
        "alarm_name": "discovery_consistency-checker_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-checker_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_consistency-checker",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_consistency-checker_role"
        ],
        "role": "aws_iam_role.discovery_consistency-checker_role.arn",
        "description": "check consistency of discovery to inventory pipeline",
        "function_name": "discovery_consistency-checker",
        "filename": "/tmp/python_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-checker",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "index.handler",
        "timeout": "60.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "memory_size": "1024.0",
        "runtime": "python3.6"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_machine-types-sync_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_machine-types-sync_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_machine-types-sync_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_machine-types-sync_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_machine-types-sync_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_machine-types-sync*"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query",
                "dynamodb:Scan"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "s3:PutObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/instance-specification/*"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/env/*"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_machine-types-sync_role.id",
        "name": "discovery_machine-types-sync_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_machine-types-sync_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_machine-types-sync"
        },
        "alarm_name": "discovery_machine-types-sync_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "100.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_machine-types-sync_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_machine-types-sync_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_machine-types-sync"
        },
        "alarm_name": "discovery_machine-types-sync_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_machine-types-sync_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_machine-types-sync",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_machine-types-sync_role"
        ],
        "role": "aws_iam_role.discovery_machine-types-sync_role.arn",
        "description": "Machine-types-sync which will the instance-specification with lates machine types",
        "function_name": "discovery_machine-types-sync",
        "filename": "/tmp/python_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_machine-types-sync",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "index.handler",
        "memory_size": "1024.0",
        "timeout": "60.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "runtime": "python3.6"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_provider-consistency-checker_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_provider-consistency-checker_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-checker_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_provider-consistency-checker_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_provider-consistency-checker_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_provider-consistency-checker*"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_provider-consistency/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_provider-consistency"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/env/*"
              ]
            },
            {
              "Action": [
                "sqs:GetQueueAttributes",
                "sqs:DeleteMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:DeleteMessageBatch",
                "sqs:ChangeMessageVisibilityBatch",
                "sqs:ReceiveMessage"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_provider-consistency-queue.arn}",
                "${aws_sqs_queue.discovery_provider-consistency-deadletter-queue.arn}"
              ]
            },
            {
              "Action": [
                "sns:Publish"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:sns:us-east-1:309983114184:discovery_provider-inconsistency-topic"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_provider-consistency-checker_role.id",
        "name": "discovery_provider-consistency-checker_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_provider-consistency-checker_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_provider-consistency-checker"
        },
        "alarm_name": "discovery_provider-consistency-checker_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "200.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-checker_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_provider-consistency-checker_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_provider-consistency-checker"
        },
        "alarm_name": "discovery_provider-consistency-checker_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-checker_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_provider-consistency-checker",
      "body": {
        "role": "aws_iam_role.discovery_provider-consistency-checker_role.arn",
        "depends_on": [
          "aws_iam_role.discovery_provider-consistency-checker_role"
        ],
        "description": "check consistency of inventory against the provider",
        "function_name": "discovery_provider-consistency-checker",
        "memory_size": "2048.0",
        "filename": "/tmp/python_lambda_stub.zip",
        "reserved_concurrent_executions": "4.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-checker",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "index.handler",
        "timeout": "180.0",
        "runtime": "python3.6",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        }
      }
    },
    {
      "type": "aws_lambda_event_source_mapping",
      "name": "discovery_provider-consistency-checker_EvtMap_discovery_provider-consistency-checker",
      "body": {
        "depends_on": [
          "aws_lambda_function.discovery_provider-consistency-checker"
        ],
        "batch_size": "1.0",
        "event_source_arn": "aws_sqs_queue.discovery_provider-consistency-queue.arn",
        "function_name": "discovery_provider-consistency-checker"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_provider-consistency-scheduler_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_provider-consistency-scheduler_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-scheduler_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_provider-consistency-scheduler_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_provider-consistency-scheduler_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_provider-consistency-scheduler*"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authorisation_token",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/authentication_key"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan",
                "dynamodb:Query"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_tenant-config"
              ]
            },
            {
              "Action": [
                "dynamodb:Scan",
                "dynamodb:Query"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_provider-consistency/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_provider-consistency"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/env/*"
              ]
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/consistency/*"
              ]
            },
            {
              "Action": [
                "sqs:GetQueueUrl",
                "sqs:SendMessage",
                "sqs:SendMessageBatch"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_provider-consistency-queue.arn}"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_provider-consistency-scheduler_role.id",
        "name": "discovery_provider-consistency-scheduler_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_provider-consistency-scheduler_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_provider-consistency-scheduler"
        },
        "alarm_name": "discovery_provider-consistency-scheduler_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "100.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-scheduler_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_provider-consistency-scheduler_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_provider-consistency-scheduler"
        },
        "alarm_name": "discovery_provider-consistency-scheduler_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-scheduler_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_provider-consistency-scheduler",
      "body": {
        "function_name": "discovery_provider-consistency-scheduler",
        "depends_on": [
          "aws_iam_role.discovery_provider-consistency-scheduler_role"
        ],
        "role": "aws_iam_role.discovery_provider-consistency-scheduler_role.arn",
        "filename": "/tmp/python_lambda_stub.zip",
        "reserved_concurrent_executions": "3.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-scheduler",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "index.handler",
        "memory_size": "1024.0",
        "timeout": "600.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "runtime": "python3.6",
        "description": "invoke provider consistency checker via SQS"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_sqs-replayer_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_sqs-replayer_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_sqs-replayer_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_sqs-replayer_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_sqs-replayer_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_sqs-replayer*"
              ]
            },
            {
              "Action": [
                "sqs:GetQueueUrl",
                "sqs:ReceiveMessage",
                "sqs:SendMessage",
                "sqs:DeleteMessage"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_publisher-queue.arn}",
                "${aws_sqs_queue.discovery_publisher-deadletter-queue.arn}"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_sqs-replayer_role.id",
        "name": "discovery_sqs-replayer_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_sqs-replayer_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_sqs-replayer"
        },
        "alarm_name": "discovery_sqs-replayer_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "100.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_sqs-replayer_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_sqs-replayer_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_sqs-replayer"
        },
        "alarm_name": "discovery_sqs-replayer_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_sqs-replayer_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_sqs-replayer",
      "body": {
        "function_name": "discovery_sqs-replayer",
        "depends_on": [
          "aws_iam_role.discovery_sqs-replayer_role"
        ],
        "role": "aws_iam_role.discovery_sqs-replayer_role.arn",
        "filename": "/tmp/python_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_sqs-replayer",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "index.handle_message",
        "memory_size": "1024.0",
        "timeout": "120.0",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "runtime": "python3.6",
        "description": "Replays messages froma source to target queue. Invoked manually."
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_decommission_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_decommission_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_decommission_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_decommission_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_decommission*"
              ]
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Scan"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_collector-config/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/discovery_collector-config",
                "arn:aws:dynamodb:us-east-1:309983114184:table/account_account/*",
                "arn:aws:dynamodb:us-east-1:309983114184:table/account_account"
              ]
            },
            {
              "Action": [
                "s3:PutObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/discovered-resources/*"
              ]
            },
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1"
              ]
            },
            {
              "Action": [
                "sqs:GetQueueAttributes",
                "sqs:GetQueueUrl",
                "sqs:ReceiveMessage",
                "sqs:SendMessage",
                "sqs:DeleteMessage"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_sqs_queue.discovery_decommission-queue.arn}",
                "${aws_sqs_queue.discovery_decommission-deadletter-queue.arn}"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_decommission_role.id",
        "name": "discovery_decommission_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_decommission_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_decommission"
        },
        "alarm_name": "discovery_decommission_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "100.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_decommission_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_decommission"
        },
        "alarm_name": "discovery_decommission_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_decommission",
      "body": {
        "function_name": "discovery_decommission",
        "depends_on": [
          "aws_iam_role.discovery_decommission_role"
        ],
        "role": "aws_iam_role.discovery_decommission_role.arn",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "timeout": "180.0",
        "memory_size": "512.0",
        "runtime": "nodejs8.10",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        },
        "description": "Account decommissionning lambda"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_decommission_account_account-topic_sns_invoke_lambda_permission",
      "body": {
        "statement_id": "discovery_decommission_account_account-topic_sns_invoke_lambda_permission",
        "depends_on": [
          "aws_lambda_function.discovery_decommission"
        ],
        "source_arn": "arn:aws:sns:us-east-1:309983114184:account_account-topic",
        "action": "lambda:InvokeFunction",
        "function_name": "aws_lambda_function.discovery_decommission.arn",
        "principal": "sns.amazonaws.com"
      }
    },
    {
      "type": "aws_sns_topic_subscription",
      "name": "discovery_decommission_Sub_account_account-topic",
      "body": {
        "endpoint": "aws_lambda_function.discovery_decommission.arn",
        "protocol": "lambda",
        "depends_on": [
          "aws_lambda_function.discovery_decommission"
        ],
        "topic_arn": "arn:aws:sns:us-east-1:309983114184:account_account-topic",
        "filter_policy": {
          "event": [
            "AccountDeactivatedEvent",
            "AccountRemovedEvent"
          ]
        }
      }
    },
    {
      "type": "aws_lambda_event_source_mapping",
      "name": "discovery_decommission_EvtMap_discovery_decommission-queue",
      "body": {
        "depends_on": [
          "aws_lambda_function.discovery_decommission"
        ],
        "batch_size": "1.0",
        "event_source_arn": "aws_sqs_queue.discovery_decommission-queue.arn",
        "function_name": "discovery_decommission"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_remediate-missing-resources_role",
      "body": {
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "lambda.amazonaws.com"
                ]
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_remediate-missing-resources_role",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_remediate-missing-resources_role",
          "CreatedBy": "Platform.S create-infra.py"
        }
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_remediate-missing-resources_role_policy",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_remediate-missing-resources_role"
        ],
        "policy": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:log-group:/aws/lambda/*discovery_remediate-missing-resources*"
              ]
            },
            {
              "Action": [
                "s3:GetObject"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:s3:::acp-platform-s-discovery-sandbox1/env/*"
              ]
            },
            {
              "Action": [
                "sqs:GetQueueUrl",
                "sqs:SendMessage",
                "sqs:SendMessageBatch"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:sqs:us-east-1:309983114184:sre_auto-remediation-queue"
              ]
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Effect": "Allow",
              "Resource": [
                "${aws_kms_key.discovery_master-key.arn}"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_remediate-missing-resources_role.id",
        "name": "discovery_remediate-missing-resources_role_policy"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_remediate-missing-resources_runaway_alarm",
      "body": {
        "evaluation_periods": "6.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "300.0",
        "datapoints_to_alarm": "6.0",
        "dimensions": {
          "FunctionName": "discovery_remediate-missing-resources"
        },
        "alarm_name": "discovery_remediate-missing-resources_runaway_alarm",
        "statistic": "SampleCount",
        "threshold": "100.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_remediate-missing-resources_runaway_alarm",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Invocations",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanOrEqualToThreshold"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_remediate-missing-resources_lambda-errors",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors an individual lambdas invocations",
        "period": "3600.0",
        "datapoints_to_alarm": "1.0",
        "dimensions": {
          "FunctionName": "discovery_remediate-missing-resources"
        },
        "alarm_name": "discovery_remediate-missing-resources_lambda-errors",
        "statistic": "Sum",
        "threshold": "0.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_remediate-missing-resources_lambda-errors",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "metric_name": "Errors",
        "lifecycle": {
          "ignore_changes": [
            "alarm_actions"
          ]
        },
        "namespace": "AWS/Lambda",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold"
      }
    },
    {
      "type": "aws_lambda_function",
      "name": "discovery_remediate-missing-resources",
      "body": {
        "depends_on": [
          "aws_iam_role.discovery_remediate-missing-resources_role"
        ],
        "role": "aws_iam_role.discovery_remediate-missing-resources_role.arn",
        "description": "Auto remediation steps for missing resources",
        "function_name": "discovery_remediate-missing-resources",
        "filename": "/tmp/nodejs_lambda_stub.zip",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_remediate-missing-resources",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "handler": "lib/index.handler",
        "memory_size": "128.0",
        "timeout": "30.0",
        "runtime": "nodejs8.10",
        "lifecycle": {
          "ignore_changes": [
            "handler",
            "environment"
          ]
        }
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_remediate-missing-resources__provider-inconsistency-topic_sns_invoke_lambda_permission",
      "body": {
        "statement_id": "discovery_remediate-missing-resources__provider-inconsistency-topic_sns_invoke_lambda_permission",
        "depends_on": [
          "aws_lambda_function.discovery_remediate-missing-resources"
        ],
        "source_arn": "aws_sns_topic.discovery_provider-inconsistency-topic.arn",
        "action": "lambda:InvokeFunction",
        "function_name": "aws_lambda_function.discovery_remediate-missing-resources.arn",
        "principal": "sns.amazonaws.com"
      }
    },
    {
      "type": "aws_sns_topic_subscription",
      "name": "discovery_remediate-missing-resources_Sub_discovery_provider-inconsistency-topic",
      "body": {
        "depends_on": [
          "aws_lambda_function.discovery_remediate-missing-resources"
        ],
        "topic_arn": "aws_sns_topic.discovery_provider-inconsistency-topic.arn",
        "endpoint": "aws_lambda_function.discovery_remediate-missing-resources.arn",
        "protocol": "lambda"
      }
    },
    {
      "type": "aws_iam_role",
      "name": "discovery_gateway-invoke-lambda",
      "body": {
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_gateway-invoke-lambda",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "assume_role_policy": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "apigateway.amazonaws.com"
              },
              "Sid": ""
            }
          ],
          "Version": "2012-10-17"
        },
        "name": "discovery_gateway-invoke-lambda"
      }
    },
    {
      "type": "aws_iam_role_policy",
      "name": "discovery_gateway-invoke-lambda_role_policy",
      "body": {
        "policy": {
          "Statement": [
            {
              "Action": [
                "lambda:InvokeFunction"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:lambda:us-east-1:309983114184:function:discovery_consistency-checker",
                "arn:aws:lambda:us-east-1:309983114184:function:discovery_provider-consistency-checker",
                "arn:aws:lambda:us-east-1:309983114184:function:discovery_provider-consistency-scheduler",
                "arn:aws:lambda:us-east-1:309983114184:function:discovery_api",
                "arn:aws:lambda:us-east-1:309983114184:function:discovery_api",
                "arn:aws:lambda:us-east-1:309983114184:function:discovery_api"
              ]
            },
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:CreateLogGroup",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:logs:*:*:*"
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "role": "aws_iam_role.discovery_gateway-invoke-lambda.id",
        "name": "discovery_gateway-invoke-lambda_role_policy"
      }
    },
    {
      "type": "aws_api_gateway_rest_api",
      "name": "discovery",
      "body": {
        "name": "discovery",
        "binary_media_types": [
          "*/*"
        ]
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-consistency-checker_resource",
      "body": {
        "parent_id": "aws_api_gateway_rest_api.discovery.root_resource_id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "consistency-checker"
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-consistency-checker_resource_proxy",
      "body": {
        "parent_id": "aws_api_gateway_resource.discovery_deployment-consistency-checker_resource.id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "{proxy+}"
      }
    },
    {
      "type": "aws_api_gateway_method",
      "name": "discovery_integration_discovery_deployment-consistency-checker_resource_ANY",
      "body": {
        "http_method": "ANY",
        "authorization": "NONE",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "resource_id": "aws_api_gateway_resource.discovery_deployment-consistency-checker_resource_proxy.id"
      }
    },
    {
      "type": "aws_api_gateway_integration",
      "name": "discovery_integration_discovery_deployment-consistency-checker_resource_ANY_int",
      "body": {
        "resource_id": "aws_api_gateway_resource.discovery_deployment-consistency-checker_resource_proxy.id",
        "uri": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.discovery_consistency-checker.arn}/invocations",
        "http_method": "aws_api_gateway_method.discovery_integration_discovery_deployment-consistency-checker_resource_ANY.http_method",
        "integration_http_method": "POST",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "credentials": "aws_iam_role.discovery_gateway-invoke-lambda.arn",
        "type": "AWS_PROXY",
        "request_templates": {
          "application/json": {
            "statusCode": "200.0"
          }
        }
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-provider-consistency-checker_resource",
      "body": {
        "parent_id": "aws_api_gateway_rest_api.discovery.root_resource_id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "provider-consistency-checker"
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-provider-consistency-checker_resource_proxy",
      "body": {
        "parent_id": "aws_api_gateway_resource.discovery_deployment-provider-consistency-checker_resource.id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "{proxy+}"
      }
    },
    {
      "type": "aws_api_gateway_method",
      "name": "discovery_integration_discovery_deployment-provider-consistency-checker_resource_ANY",
      "body": {
        "http_method": "ANY",
        "authorization": "NONE",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "resource_id": "aws_api_gateway_resource.discovery_deployment-provider-consistency-checker_resource_proxy.id"
      }
    },
    {
      "type": "aws_api_gateway_integration",
      "name": "discovery_integration_discovery_deployment-provider-consistency-checker_resource_ANY_int",
      "body": {
        "resource_id": "aws_api_gateway_resource.discovery_deployment-provider-consistency-checker_resource_proxy.id",
        "uri": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.discovery_provider-consistency-checker.arn}/invocations",
        "http_method": "aws_api_gateway_method.discovery_integration_discovery_deployment-provider-consistency-checker_resource_ANY.http_method",
        "integration_http_method": "POST",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "credentials": "aws_iam_role.discovery_gateway-invoke-lambda.arn",
        "type": "AWS_PROXY",
        "request_templates": {
          "application/json": {
            "statusCode": "200.0"
          }
        }
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-provider-consistency-scheduler_resource",
      "body": {
        "parent_id": "aws_api_gateway_rest_api.discovery.root_resource_id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "provider-consistency-scheduler"
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-provider-consistency-scheduler_resource_proxy",
      "body": {
        "parent_id": "aws_api_gateway_resource.discovery_deployment-provider-consistency-scheduler_resource.id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "{proxy+}"
      }
    },
    {
      "type": "aws_api_gateway_method",
      "name": "discovery_integration_discovery_deployment-provider-consistency-scheduler_resource_ANY",
      "body": {
        "http_method": "ANY",
        "authorization": "NONE",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "resource_id": "aws_api_gateway_resource.discovery_deployment-provider-consistency-scheduler_resource_proxy.id"
      }
    },
    {
      "type": "aws_api_gateway_integration",
      "name": "discovery_integration_discovery_deployment-provider-consistency-scheduler_resource_ANY_int",
      "body": {
        "resource_id": "aws_api_gateway_resource.discovery_deployment-provider-consistency-scheduler_resource_proxy.id",
        "uri": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.discovery_provider-consistency-scheduler.arn}/invocations",
        "http_method": "aws_api_gateway_method.discovery_integration_discovery_deployment-provider-consistency-scheduler_resource_ANY.http_method",
        "integration_http_method": "POST",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "credentials": "aws_iam_role.discovery_gateway-invoke-lambda.arn",
        "type": "AWS_PROXY",
        "request_templates": {
          "application/json": {
            "statusCode": "200.0"
          }
        }
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-tenants_resource",
      "body": {
        "parent_id": "aws_api_gateway_rest_api.discovery.root_resource_id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "tenants"
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-tenants_resource_proxy",
      "body": {
        "parent_id": "aws_api_gateway_resource.discovery_deployment-tenants_resource.id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "{proxy+}"
      }
    },
    {
      "type": "aws_api_gateway_method",
      "name": "discovery_integration_discovery_deployment-tenants_resource_ANY",
      "body": {
        "http_method": "ANY",
        "authorization": "NONE",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "resource_id": "aws_api_gateway_resource.discovery_deployment-tenants_resource_proxy.id"
      }
    },
    {
      "type": "aws_api_gateway_integration",
      "name": "discovery_integration_discovery_deployment-tenants_resource_ANY_int",
      "body": {
        "resource_id": "aws_api_gateway_resource.discovery_deployment-tenants_resource_proxy.id",
        "uri": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.discovery_api.arn}/invocations",
        "http_method": "aws_api_gateway_method.discovery_integration_discovery_deployment-tenants_resource_ANY.http_method",
        "integration_http_method": "POST",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "credentials": "aws_iam_role.discovery_gateway-invoke-lambda.arn",
        "type": "AWS_PROXY",
        "request_templates": {
          "application/json": {
            "statusCode": "200.0"
          }
        }
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-failures_resource",
      "body": {
        "parent_id": "aws_api_gateway_rest_api.discovery.root_resource_id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "failures"
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-failures_resource_proxy",
      "body": {
        "parent_id": "aws_api_gateway_resource.discovery_deployment-failures_resource.id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "{proxy+}"
      }
    },
    {
      "type": "aws_api_gateway_method",
      "name": "discovery_integration_discovery_deployment-failures_resource_ANY",
      "body": {
        "http_method": "ANY",
        "authorization": "NONE",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "resource_id": "aws_api_gateway_resource.discovery_deployment-failures_resource_proxy.id"
      }
    },
    {
      "type": "aws_api_gateway_integration",
      "name": "discovery_integration_discovery_deployment-failures_resource_ANY_int",
      "body": {
        "resource_id": "aws_api_gateway_resource.discovery_deployment-failures_resource_proxy.id",
        "uri": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.discovery_api.arn}/invocations",
        "http_method": "aws_api_gateway_method.discovery_integration_discovery_deployment-failures_resource_ANY.http_method",
        "integration_http_method": "POST",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "credentials": "aws_iam_role.discovery_gateway-invoke-lambda.arn",
        "type": "AWS_PROXY",
        "request_templates": {
          "application/json": {
            "statusCode": "200.0"
          }
        }
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-suspendedAccounts_resource",
      "body": {
        "parent_id": "aws_api_gateway_rest_api.discovery.root_resource_id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "suspendedAccounts"
      }
    },
    {
      "type": "aws_api_gateway_resource",
      "name": "discovery_deployment-suspendedAccounts_resource_proxy",
      "body": {
        "parent_id": "aws_api_gateway_resource.discovery_deployment-suspendedAccounts_resource.id",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "path_part": "{proxy+}"
      }
    },
    {
      "type": "aws_api_gateway_method",
      "name": "discovery_integration_discovery_deployment-suspendedAccounts_resource_ANY",
      "body": {
        "http_method": "ANY",
        "authorization": "NONE",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "resource_id": "aws_api_gateway_resource.discovery_deployment-suspendedAccounts_resource_proxy.id"
      }
    },
    {
      "type": "aws_api_gateway_integration",
      "name": "discovery_integration_discovery_deployment-suspendedAccounts_resource_ANY_int",
      "body": {
        "resource_id": "aws_api_gateway_resource.discovery_deployment-suspendedAccounts_resource_proxy.id",
        "uri": "arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/${aws_lambda_function.discovery_api.arn}/invocations",
        "http_method": "aws_api_gateway_method.discovery_integration_discovery_deployment-suspendedAccounts_resource_ANY.http_method",
        "integration_http_method": "POST",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "credentials": "aws_iam_role.discovery_gateway-invoke-lambda.arn",
        "type": "AWS_PROXY",
        "request_templates": {
          "application/json": {
            "statusCode": "200.0"
          }
        }
      }
    },
    {
      "type": "aws_api_gateway_base_path_mapping",
      "name": "discovery_deployment-base-path-mapping",
      "body": {
        "stage_name": "sandbox1",
        "depends_on": [
          "aws_api_gateway_deployment.discovery_deployment"
        ],
        "domain_name": "api.sandbox1.cloudplatform.accenture.com",
        "api_id": "aws_api_gateway_rest_api.discovery.id",
        "base_path": "discovery"
      }
    },
    {
      "type": "aws_api_gateway_deployment",
      "name": "discovery_deployment",
      "body": {
        "stage_name": "sandbox1",
        "rest_api_id": "aws_api_gateway_rest_api.discovery.id",
        "depends_on": [
          "aws_api_gateway_integration.discovery_integration_discovery_deployment-consistency-checker_resource_ANY_int",
          "aws_api_gateway_integration.discovery_integration_discovery_deployment-provider-consistency-checker_resource_ANY_int",
          "aws_api_gateway_integration.discovery_integration_discovery_deployment-provider-consistency-scheduler_resource_ANY_int",
          "aws_api_gateway_integration.discovery_integration_discovery_deployment-tenants_resource_ANY_int",
          "aws_api_gateway_integration.discovery_integration_discovery_deployment-failures_resource_ANY_int",
          "aws_api_gateway_integration.discovery_integration_discovery_deployment-suspendedAccounts_resource_ANY_int"
        ]
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_collector-sqs-age",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors the discovery collector queue to alert when messages are close to reaching the timeout retention",
        "namespace": "AWS/SQS",
        "period": "60.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-sqs-age",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_collector-queue"
        },
        "statistic": "Maximum",
        "threshold": "900.0",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_collector-sqs-age",
        "metric_name": "ApproximateAgeOfOldestMessage"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_collector-sqs-deadletter-depth",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors the discovery collector deadletter queue to alert when messages fail to be processed and end up in the dead letter queue",
        "namespace": "AWS/SQS",
        "period": "60.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-sqs-deadletter-depth",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_collector-deadletter-queue"
        },
        "statistic": "Sum",
        "threshold": "0.0",
        "treat_missing_data": "ignore",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_collector-sqs-deadletter-depth",
        "metric_name": "ApproximateNumberOfMessagesVisible"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_collector-messages-sent-low",
      "body": {
        "evaluation_periods": "5.0",
        "alarm_description": "This alarm monitors the discovery collector queue to alert when messages sent is less or equal to the number expected.",
        "namespace": "AWS/SQS",
        "period": "300.0",
        "datapoints_to_alarm": "5.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_collector-messages-sent-low",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_collector-queue"
        },
        "statistic": "Sum",
        "threshold": "-1",
        "comparison_operator": "LessThanOrEqualToThreshold",
        "alarm_name": "discovery_collector-messages-sent-low",
        "metric_name": "NumberOfMessagesSent"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-engine-sqs-age",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors the discovery diff-engine queue to alert when messages are close to reaching the 1 hour timeout retention",
        "namespace": "AWS/SQS",
        "period": "60.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-engine-sqs-age",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_diff-engine-queue"
        },
        "statistic": "Maximum",
        "threshold": "3000.0",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_diff-engine-sqs-age",
        "metric_name": "ApproximateAgeOfOldestMessage"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-engine-sqs-deadletter-depth",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors the discovery diff-engine queue to alert when messages fail to be processed and end up in the dead letter queue",
        "namespace": "AWS/SQS",
        "period": "60.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-engine-sqs-deadletter-depth",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_diff-engine-deadletter-queue"
        },
        "statistic": "Sum",
        "threshold": "0.0",
        "treat_missing_data": "ignore",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_diff-engine-sqs-deadletter-depth",
        "metric_name": "ApproximateNumberOfMessagesVisible"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_publisher-sqs-age",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors the discovery publisher queue to alert when messages are close to reaching the 1 hour timeout retention",
        "namespace": "AWS/SQS",
        "period": "60.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher-sqs-age",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_publisher-queue"
        },
        "statistic": "Maximum",
        "threshold": "3000.0",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_publisher-sqs-age",
        "metric_name": "ApproximateAgeOfOldestMessage"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_publisher-sqs-deadletter-depth",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors the discovery publisher queue to alert when messages fail to be processed and end up in the dead letter queue",
        "namespace": "AWS/SQS",
        "period": "60.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_publisher-sqs-deadletter-depth",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_publisher-deadletter-queue"
        },
        "statistic": "Sum",
        "threshold": "0.0",
        "treat_missing_data": "ignore",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_publisher-sqs-deadletter-depth",
        "metric_name": "ApproximateNumberOfMessagesVisible"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-tagging-iterator-age",
      "body": {
        "evaluation_periods": "2.0",
        "alarm_description": "This will fire if the lambda iterator age is more than 30 minutes old",
        "namespace": "AWS/Lambda",
        "period": "300.0",
        "datapoints_to_alarm": "2.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-tagging-iterator-age",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "FunctionName": "discovery_diff-tagging"
        },
        "statistic": "Maximum",
        "threshold": "1800000.0",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_diff-tagging-iterator-age",
        "metric_name": "IteratorAge"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-tagging-failed-event-error",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "discovery_diff-tagging failed to process a kinesis event",
        "namespace": "diff_tagging_log_metrics",
        "period": "300.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-tagging-failed-event-error",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "alarm_name": "discovery_diff-tagging-failed-event-error",
        "statistic": "Sum",
        "threshold": "1.0",
        "comparison_operator": "GreaterThanThreshold",
        "metric_name": "diff_tagging_failed_event"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_diff-engine-schema-validation-failures",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "Schema Validation failed for a set of resources",
        "namespace": "schema_validation_metrics",
        "period": "300.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_diff-engine-schema-validation-failures",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "alarm_name": "discovery_diff-engine-schema-validation-failures",
        "statistic": "Sum",
        "threshold": "1.0",
        "comparison_operator": "GreaterThanThreshold",
        "metric_name": "schema-validation-failures"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_decommission-failures",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "Account decommissioning failed for an account",
        "namespace": "AWS/Lambda",
        "period": "300.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission-failures",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "FunctionName": "discovery_decommission"
        },
        "statistic": "Sum",
        "threshold": "0.0",
        "treat_missing_data": "ignore",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_decommission-failures",
        "metric_name": "Errors"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_decommission-sqs-deadletter-depth",
      "body": {
        "evaluation_periods": "1.0",
        "alarm_description": "This metric monitors the discovery decommission deadletter queue to alert when messages fail to be processed and end up in the dead letter queue",
        "namespace": "AWS/SQS",
        "period": "60.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_decommission-sqs-deadletter-depth",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "QueueName": "discovery_decommission-deadletter-queue"
        },
        "statistic": "Sum",
        "threshold": "0.0",
        "treat_missing_data": "ignore",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_decommission-sqs-deadletter-depth",
        "metric_name": "ApproximateNumberOfMessagesVisible"
      }
    },
    {
      "type": "aws_elasticache_replication_group",
      "name": "discovery_cache-replication-group1",
      "body": {
        "engine": "redis",
        "replication_group_id": "discovery-cache",
        "depends_on": [
          "aws_elasticache_subnet_group.discovery_cache-subnet-group1",
          "aws_security_group.discovery_cache-security-group1"
        ],
        "subnet_group_name": "discovery-cache-subnet-group1",
        "replication_group_description": "discovery cache used by Platform.S",
        "parameter_group_name": "default.redis4.0",
        "node_type": "cache.t2.micro",
        "security_group_ids": [
          "aws_security_group.discovery_cache-security-group1.id"
        ],
        "port": "6379.0",
        "apply_immediately": "true",
        "transit_encryption_enabled": "true",
        "engine_version": "4.0.10",
        "at_rest_encryption_enabled": "true",
        "automatic_failover_enabled": "false",
        "number_cache_clusters": "1.0"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_cache-replication-group1_elasticache-cpu-utilization-exceeded",
      "body": {
        "evaluation_periods": "25.0",
        "depends_on": [
          "aws_elasticache_replication_group.discovery_cache-replication-group1"
        ],
        "alarm_description": "This will fire if the CPU utilization exceeds 10 percent at the instance level 5 times within 2 hours",
        "period": "300.0",
        "datapoints_to_alarm": "5.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_cache-replication-group1_elasticache-cpu-utilization-exceeded",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_cache-replication-group1"
        },
        "statistic": "Maximum",
        "threshold": "10.0",
        "metric_name": "CPUUtilization",
        "namespace": "AWS/ElastiCache",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_cache-replication-group1_elasticache-cpu-utilization-exceeded"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_cache-replication-group1_elasticache-engine-cpu-utilization-exceeded",
      "body": {
        "evaluation_periods": "25.0",
        "depends_on": [
          "aws_elasticache_replication_group.discovery_cache-replication-group1"
        ],
        "alarm_description": "This will fire if the CPU utilization exceeds 30 percent at the Redis process level 5 times within 2 hours",
        "period": "300.0",
        "datapoints_to_alarm": "5.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_cache-replication-group1_elasticache-engine-cpu-utilization-exceeded",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_cache-replication-group1"
        },
        "statistic": "Maximum",
        "threshold": "30.0",
        "metric_name": "EngineCPUUtilization",
        "namespace": "AWS/ElastiCache",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_cache-replication-group1_elasticache-engine-cpu-utilization-exceeded"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_cache-replication-group1_elasticache-swap-usage",
      "body": {
        "evaluation_periods": "1.0",
        "depends_on": [
          "aws_elasticache_replication_group.discovery_cache-replication-group1"
        ],
        "alarm_description": "This will fire if the amount swap used on the host exceeds 50MB at any point in time",
        "period": "300.0",
        "datapoints_to_alarm": "1.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_cache-replication-group1_elasticache-swap-usage",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_cache-replication-group1"
        },
        "statistic": "Maximum",
        "threshold": "50000000.0",
        "metric_name": "SwapUsage",
        "namespace": "AWS/ElastiCache",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_cache-replication-group1_elasticache-swap-usage"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_cache-replication-group1_elasticache-evictions",
      "body": {
        "evaluation_periods": "1.0",
        "depends_on": [
          "aws_elasticache_replication_group.discovery_cache-replication-group1"
        ],
        "alarm_description": "This will fire if any keys have been evicted due to having no memory left on the cache",
        "period": "300.0",
        "datapoints_to_alarm": "1.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_cache-replication-group1_elasticache-evictions",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_cache-replication-group1"
        },
        "statistic": "Sum",
        "threshold": "1.0",
        "metric_name": "Evictions",
        "namespace": "AWS/ElastiCache",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_cache-replication-group1_elasticache-evictions"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_cache-replication-group1_elasticache-curr-connections",
      "body": {
        "evaluation_periods": "1.0",
        "depends_on": [
          "aws_elasticache_replication_group.discovery_cache-replication-group1"
        ],
        "alarm_description": "This will fire if the number of client connections exceeds 300 within 5 minutes",
        "period": "300.0",
        "datapoints_to_alarm": "1.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_cache-replication-group1_elasticache-curr-connections",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_cache-replication-group1"
        },
        "statistic": "Sum",
        "threshold": "300.0",
        "metric_name": "CurrConnections",
        "namespace": "AWS/ElastiCache",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_cache-replication-group1_elasticache-curr-connections"
      }
    },
    {
      "type": "aws_kms_alias",
      "name": "discovery_master-key-alias",
      "body": {
        "target_key_id": "aws_kms_key.discovery_master-key.id",
        "name_prefix": "alias/discovery_master-key"
      }
    },
    {
      "type": "aws_kms_key",
      "name": "discovery_master-key",
      "body": {
        "enable_key_rotation": "true",
        "description": "Master key used for encrypting infrastructure in discovery",
        "policy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt"
              ],
              "Resource": "*",
              "Effect": "Allow",
              "Principal": {
                "Service": "sns.amazonaws.com"
              }
            },
            {
              "Action": [
                "kms:GenerateDataKey",
                "kms:Decrypt"
              ],
              "Resource": "*",
              "Effect": "Allow",
              "Principal": {
                "AWS": [
                  "arn:aws:iam::309983114184:root"
                ]
              }
            },
            {
              "Action": "kms:*",
              "Principal": {
                "AWS": [
                  "arn:aws:iam::309983114184:user/deployer",
                  "arn:aws:iam::309983114184:role/Admin",
                  "arn:aws:iam::309983114184:user/acpapi"
                ]
              },
              "Resource": "*",
              "Effect": "Allow",
              "Sid": "Enable Deployment Permissions"
            }
          ]
        },
        "lifecycle": {
          "prevent_destroy": "true"
        },
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "description": "Master key used for encrypting sqs and other infra items",
          "CreatedBy": "Platform.S create-infra.py",
          "Name": "discoveryMasterKey"
        }
      }
    },
    {
      "type": "aws_cloudwatch_log_group",
      "name": "discovery_agents",
      "body": {
        "name": "discovery_agents"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "acp-platform-s-discovery-sandbox1-discovery_event-adapter_permission",
      "body": {
        "statement_id": "acp-platform-s-discovery-sandbox1-discovery_event-adapter_permission",
        "action": "lambda:InvokeFunction",
        "source_arn": "arn:aws:s3:::acp-platform-s-discovery-sandbox1",
        "function_name": "aws_lambda_function.discovery_event-adapter.arn",
        "principal": "s3.amazonaws.com"
      }
    },
    {
      "type": "aws_s3_bucket_notification",
      "name": "discovery_bucket-notification",
      "body": {
        "lambda_function": {
          "lambda_function_arn": "aws_lambda_function.discovery_event-adapter.arn",
          "events": [
            "s3:ObjectCreated:*"
          ],
          "filter_prefix": "throttled-collector-publisher/",
          "filter_suffix": ".json.gz"
        },
        "depends_on": [
          "aws_sns_topic.discovery_s3-notification-topic",
          "aws_sns_topic.discovery_s3-notification-topic",
          "aws_sns_topic.discovery_diff-engine-topic",
          "aws_sns_topic.discovery_diff-engine-topic",
          "aws_sns_topic.discovery_diff-engine-topic",
          "aws_sns_topic.discovery_diff-engine-topic",
          "aws_sns_topic.discovery_publisher-topic",
          "aws_sns_topic.discovery_publisher-topic",
          "aws_sns_topic.discovery_publisher-topic",
          "aws_sns_topic.discovery_publisher-topic",
          "aws_lambda_function.discovery_event-adapter",
          "aws_lambda_function.discovery_event-adapter",
          "aws_lambda_function.discovery_event-adapter",
          "aws_lambda_function.discovery_event-adapter"
        ],
        "bucket": "acp-platform-s-discovery-sandbox1",
        "topic": {
          "topic_arn": "aws_sns_topic.discovery_publisher-topic.arn",
          "events": [
            "s3:ObjectCreated:*"
          ],
          "filter_prefix": "throttled-collector-diff-engine/",
          "filter_suffix": ".json.gz"
        }
      }
    },
    {
      "type": "aws_kinesis_stream",
      "name": "discovery_event-bus",
      "body": {
        "name": "discovery_event-bus",
        "encryption_type": "KMS",
        "kms_key_id": "alias/aws/kinesis",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-bus",
          "CreatedBy": "platform.s deployer",
          "Description": "Stream Discovery events to subscribers"
        },
        "retention_period": "168.0",
        "shard_count": "1.0"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_event-bus_kinesis-readexceeded",
      "body": {
        "evaluation_periods": "1.0",
        "depends_on": [
          "aws_kinesis_stream.discovery_event-bus"
        ],
        "alarm_description": "This will fire if the Read throughput has exceeded on the Kinesis Stream",
        "period": "300.0",
        "datapoints_to_alarm": "1.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-bus_kinesis-readexceeded",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_event-bus"
        },
        "statistic": "Average",
        "threshold": "1.0",
        "metric_name": "ReadProvisionedThroughputExceeded",
        "namespace": "AWS/Kinesis",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_event-bus_kinesis-readexceeded"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_event-bus_kinesis-writeexceeded",
      "body": {
        "evaluation_periods": "1.0",
        "depends_on": [
          "aws_kinesis_stream.discovery_event-bus"
        ],
        "alarm_description": "This will fire if the Write throughput has exceeded on the Kinesis Stream",
        "period": "300.0",
        "datapoints_to_alarm": "1.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-bus_kinesis-writeexceeded",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_event-bus"
        },
        "statistic": "Average",
        "threshold": "1.0",
        "metric_name": "WriteProvisionedThroughputExceeded",
        "namespace": "AWS/Kinesis",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_event-bus_kinesis-writeexceeded"
      }
    },
    {
      "type": "aws_cloudwatch_metric_alarm",
      "name": "discovery_event-bus_kinesis-iteratoragemilliseconds",
      "body": {
        "evaluation_periods": "2.0",
        "depends_on": [
          "aws_kinesis_stream.discovery_event-bus"
        ],
        "alarm_description": "This will fire if the record throughput age is more than 30 minutes old",
        "period": "300.0",
        "datapoints_to_alarm": "2.0",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_event-bus_kinesis-iteratoragemilliseconds",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "dimensions": {
          "StreamName": "discovery_event-bus"
        },
        "statistic": "Maximum",
        "threshold": "1800000.0",
        "metric_name": "GetRecords.IteratorAgeMilliseconds",
        "namespace": "AWS/Kinesis",
        "treat_missing_data": "notBreaching",
        "comparison_operator": "GreaterThanThreshold",
        "alarm_name": "discovery_event-bus_kinesis-iteratoragemilliseconds"
      }
    },
    {
      "type": "aws_cloudwatch_event_target",
      "name": "discovery_scheduler-rule_target",
      "body": {
        "depends_on": [
          "aws_cloudwatch_event_rule.discovery_scheduler-rule",
          "aws_lambda_function.discovery_scheduler"
        ],
        "target_id": "discovery_scheduler-rule_target",
        "arn": "aws_lambda_function.discovery_scheduler.arn",
        "rule": "discovery_scheduler-rule"
      }
    },
    {
      "type": "aws_cloudwatch_event_rule",
      "name": "discovery_scheduler-rule",
      "body": {
        "is_enabled": "false",
        "name": "discovery_scheduler-rule",
        "description": "Schedule invocation of the scheduler lambda",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_scheduler-rule",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "schedule_expression": "rate(5 minutes)"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_scheduler-rule_invoke",
      "body": {
        "statement_id": "discovery_scheduler-rule_invoke",
        "action": "lambda:InvokeFunction",
        "source_arn": "aws_cloudwatch_event_rule.discovery_scheduler-rule.arn",
        "function_name": "aws_lambda_function.discovery_scheduler.arn",
        "principal": "events.amazonaws.com"
      }
    },
    {
      "type": "aws_cloudwatch_event_target",
      "name": "discovery_legacy-scheduler-rule_target",
      "body": {
        "depends_on": [
          "aws_cloudwatch_event_rule.discovery_legacy-scheduler-rule",
          "aws_lambda_function.discovery_legacy-scheduler"
        ],
        "target_id": "discovery_legacy-scheduler-rule_target",
        "arn": "aws_lambda_function.discovery_legacy-scheduler.arn",
        "rule": "discovery_legacy-scheduler-rule"
      }
    },
    {
      "type": "aws_cloudwatch_event_rule",
      "name": "discovery_legacy-scheduler-rule",
      "body": {
        "is_enabled": "false",
        "name": "discovery_legacy-scheduler-rule",
        "description": "Schedule invocation of the legacy scheduler lambda",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_legacy-scheduler-rule",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "schedule_expression": "rate(1 minute)"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_legacy-scheduler-rule_invoke",
      "body": {
        "statement_id": "discovery_legacy-scheduler-rule_invoke",
        "action": "lambda:InvokeFunction",
        "source_arn": "aws_cloudwatch_event_rule.discovery_legacy-scheduler-rule.arn",
        "function_name": "aws_lambda_function.discovery_legacy-scheduler.arn",
        "principal": "events.amazonaws.com"
      }
    },
    {
      "type": "aws_cloudwatch_event_target",
      "name": "discovery_machine-types-sync-rule_target",
      "body": {
        "depends_on": [
          "aws_cloudwatch_event_rule.discovery_machine-types-sync-rule",
          "aws_lambda_function.discovery_machine-types-sync"
        ],
        "target_id": "discovery_machine-types-sync-rule_target",
        "arn": "aws_lambda_function.discovery_machine-types-sync.arn",
        "rule": "discovery_machine-types-sync-rule"
      }
    },
    {
      "type": "aws_cloudwatch_event_rule",
      "name": "discovery_machine-types-sync-rule",
      "body": {
        "description": "Schedule regular invocation of machine-types-sync",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_machine-types-sync-rule",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "schedule_expression": "cron(0 0 * * ? *)",
        "name": "discovery_machine-types-sync-rule"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_machine-types-sync-rule_invoke",
      "body": {
        "statement_id": "discovery_machine-types-sync-rule_invoke",
        "action": "lambda:InvokeFunction",
        "source_arn": "aws_cloudwatch_event_rule.discovery_machine-types-sync-rule.arn",
        "function_name": "aws_lambda_function.discovery_machine-types-sync.arn",
        "principal": "events.amazonaws.com"
      }
    },
    {
      "type": "aws_cloudwatch_event_target",
      "name": "discovery_consistency-checker-scheduler-rule_target",
      "body": {
        "depends_on": [
          "aws_cloudwatch_event_rule.discovery_consistency-checker-scheduler-rule",
          "aws_lambda_function.discovery_consistency-checker"
        ],
        "target_id": "discovery_consistency-checker-scheduler-rule_target",
        "arn": "aws_lambda_function.discovery_consistency-checker.arn",
        "rule": "discovery_consistency-checker-scheduler-rule"
      }
    },
    {
      "type": "aws_cloudwatch_event_rule",
      "name": "discovery_consistency-checker-scheduler-rule",
      "body": {
        "description": "Schedule regular invocation discovery-consistency-checker api",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_consistency-checker-scheduler-rule",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "schedule_expression": "cron(0 * * * ? *)",
        "name": "discovery_consistency-checker-scheduler-rule"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_consistency-checker-scheduler-rule_invoke",
      "body": {
        "statement_id": "discovery_consistency-checker-scheduler-rule_invoke",
        "action": "lambda:InvokeFunction",
        "source_arn": "aws_cloudwatch_event_rule.discovery_consistency-checker-scheduler-rule.arn",
        "function_name": "aws_lambda_function.discovery_consistency-checker.arn",
        "principal": "events.amazonaws.com"
      }
    },
    {
      "type": "aws_cloudwatch_event_target",
      "name": "discovery_provider-consistency-scheduler-rule_target",
      "body": {
        "depends_on": [
          "aws_cloudwatch_event_rule.discovery_provider-consistency-scheduler-rule",
          "aws_lambda_function.discovery_provider-consistency-scheduler"
        ],
        "target_id": "discovery_provider-consistency-scheduler-rule_target",
        "arn": "aws_lambda_function.discovery_provider-consistency-scheduler.arn",
        "rule": "discovery_provider-consistency-scheduler-rule"
      }
    },
    {
      "type": "aws_cloudwatch_event_rule",
      "name": "discovery_provider-consistency-scheduler-rule",
      "body": {
        "description": "Schedule regular invocation discovery_provider-consistency-scheduler api",
        "tags": {
          "Environment": "sandbox1",
          "Component": "discovery",
          "Name": "discovery_provider-consistency-scheduler-rule",
          "CreatedBy": "Platform.S create-infra.py"
        },
        "schedule_expression": "cron(0 * * * ? *)",
        "name": "discovery_provider-consistency-scheduler-rule"
      }
    },
    {
      "type": "aws_lambda_permission",
      "name": "discovery_provider-consistency-scheduler-rule_invoke",
      "body": {
        "statement_id": "discovery_provider-consistency-scheduler-rule_invoke",
        "action": "lambda:InvokeFunction",
        "source_arn": "aws_cloudwatch_event_rule.discovery_provider-consistency-scheduler-rule.arn",
        "function_name": "aws_lambda_function.discovery_provider-consistency-scheduler.arn",
        "principal": "events.amazonaws.com"
      }
    },
    {
      "type": "aws_cloudwatch_log_metric_filter",
      "name": "discovery_diff-engine-schema-validation-fails",
      "body": {
        "pattern": "WARNING Schema validation failed",
        "name": "discovery_diff-engine-schema-validation-fails",
        "log_group_name": "/aws/fargate/discovery_diff-engine",
        "metric_transformation": {
          "name": "schema-validation-failures",
          "namespace": "schema_validation_metrics",
          "value": "1"
        }
      }
    },
    {
      "type": "aws_s3_bucket_object",
      "name": "discovery_cpsc-vmware-config",
      "body": {
        "bucket": "acp-platform-s-discovery-sandbox1",
        "source": "/Users/james.n.wilson/code/work/repos/cd-pipeline/../service-discovery//infrastructure/default-config/cpsc-vmware-config.json",
        "etag": "",
        "key": "default-config/cpsc-vmware-config.json"
      }
    },
    {
      "type": "aws_s3_bucket_object",
      "name": "discovery_cpsc-resource-group-config",
      "body": {
        "bucket": "acp-platform-s-discovery-sandbox1",
        "source": "/Users/james.n.wilson/code/work/repos/cd-pipeline/../service-discovery//infrastructure/default-config/cpsc-resource-group-config.json",
        "etag": "",
        "key": "default-config/cpsc-resource-group-config.json"
      }
    },
    {
      "type": "aws_s3_bucket_object",
      "name": "discovery_cpsc-resource-tag-config",
      "body": {
        "bucket": "acp-platform-s-discovery-sandbox1",
        "source": "/Users/james.n.wilson/code/work/repos/cd-pipeline/../service-discovery//infrastructure/default-config/cpsc-resource-tag-config.json",
        "etag": "",
        "key": "default-config/cpsc-resource-tag-config.json"
      }
    }
  ],
  "relationships": [
    {
      "in": "aws_sqs_queue.discovery_publisher-queue",
      "out": "aws_lambda_function.discovery_publisher",
      "label": ""
    },
    {
      "in": "aws_sqs_queue.discovery_consistency-checker-queue",
      "out": "aws_lambda_function.discovery_consistency-checker",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_vpc-flow-log-role",
      "out": "",
      "label": "['logs:DescribeLogStreams']"
    },
    {
      "in": "aws_iam_role.discovery_vpc-flow-log-role",
      "out": "",
      "label": "['logs:CreateLogStream']"
    },
    {
      "in": "aws_iam_role.discovery_vpc-flow-log-role",
      "out": "",
      "label": "['logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "*",
      "label": "['cloudwatch:PutMetricData','cloudwatch:GetMetricStatistics']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_sqs_queue.discovery_collector-queue",
      "label": "['sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_sqs_queue.discovery_collector-deadletter-queue",
      "label": "['sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:GetItem','dynamodb:UpdateItem']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/*",
      "label": "['s3:PutObject']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/env/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/component-test/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/throttleCollector/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/container-env-vars/collector.json",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/*",
      "label": "['s3:DeleteObject']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_sns_topic.discovery_scheduled-discovery-topic",
      "label": "['sns:Publish']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "*",
      "label": "['ec2:Describe*']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "",
      "label": "['kms:GenerateDataKeyWithoutPlaintext','kms:Encrypt','kms:Decrypt']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-collector-role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "*",
      "label": "['cloudwatch:PutMetricData','cloudwatch:GetMetricStatistics']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "aws_sqs_queue.discovery_diff-engine-queue",
      "label": "['sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "aws_sqs_queue.discovery_diff-engine-deadletter-queue",
      "label": "['sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/*",
      "label": "['s3:PutObject','s3:GetObject','s3:GetObjectTagging','s3:PutObjectTagging']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/container-env-vars/diff-engine.json",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "aws_sns_topic.discovery_publisher-topic",
      "label": "['sns:Publish']"
    },
    {
      "in": "aws_iam_role.discovery_ecs-diff-engine-role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "aws_dynamodb_table.discovery_account-executions",
      "label": "['dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "aws_dynamodb_table.discovery_executions",
      "label": "['dynamodb:Query','dynamodb:GetItem','dynamodb:BatchGetItem']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "aws_dynamodb_table.authorisation_token",
      "label": "['dynamodb:GetItem']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "aws_dynamodb_table.authentication_key",
      "label": "['dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:GetItem','dynamodb:UpdateItem','dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "*",
      "label": "['ec2:CreateNetworkInterface','ec2:DescribeNetworkInterfaces','ec2:DetachNetworkInterface','ec2:DeleteNetworkInterface']"
    },
    {
      "in": "aws_iam_role.discovery_api_role",
      "out": "*",
      "label": "['ec2:CreateNetworkInterface','ec2:DescribeNetworkInterfaces','ec2:DeleteNetworkInterface']"
    },
    {
      "in": "aws_lambda_function.discovery_api",
      "out": "aws_iam_role.discovery_api_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_container-config_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_container-config_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/container-env-vars/*",
      "label": "['s3:PutObject']"
    },
    {
      "in": "aws_iam_role.discovery_container-config_role",
      "out": "*",
      "label": "['ec2:CreateNetworkInterface','ec2:DescribeNetworkInterfaces','ec2:DeleteNetworkInterface']"
    },
    {
      "in": "aws_lambda_function.discovery_container-config",
      "out": "aws_iam_role.discovery_container-config_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_scheduler_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_scheduler_role",
      "out": "aws_dynamodb_table.discovery_collector-config",
      "label": "['dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_scheduler_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_scheduler_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:UpdateItem']"
    },
    {
      "in": "aws_iam_role.discovery_scheduler_role",
      "out": "aws_sns_topic.discovery_scheduled-discovery-topic",
      "label": "['sns:Publish']"
    },
    {
      "in": "aws_iam_role.discovery_scheduler_role",
      "out": "",
      "label": "['events:DescribeRule']"
    },
    {
      "in": "aws_lambda_function.discovery_scheduler",
      "out": "aws_iam_role.discovery_scheduler_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_legacy-scheduler_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_legacy-scheduler_role",
      "out": "aws_dynamodb_table.discovery_collector-config",
      "label": "['dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_legacy-scheduler_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_legacy-scheduler_role",
      "out": "aws_sns_topic.discovery_scheduled-discovery-topic",
      "label": "['sns:Publish']"
    },
    {
      "in": "aws_iam_role.discovery_legacy-scheduler_role",
      "out": "",
      "label": "['events:DescribeRule']"
    },
    {
      "in": "aws_lambda_function.discovery_legacy-scheduler",
      "out": "aws_iam_role.discovery_legacy-scheduler_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_publisher_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_publisher_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/*",
      "label": "['s3:PutObject','s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_publisher_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_publisher_role",
      "out": "aws_sqs_queue.discovery_publisher-queue",
      "label": "['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_publisher_role",
      "out": "aws_sqs_queue.discovery_publisher-deadletter-queue",
      "label": "['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_publisher_role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_iam_role.discovery_publisher_role",
      "out": "aws_sns_topic.discovery_events-topic",
      "label": "['sns:Publish']"
    },
    {
      "in": "aws_lambda_function.discovery_publisher",
      "out": "aws_iam_role.discovery_publisher_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_event-adapter_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_event-adapter_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/publisher/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_event-adapter_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/throttled-collector-publisher/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_event-adapter_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_event-adapter_role",
      "out": "aws_kinesis_stream.discovery_event-bus",
      "label": "['kinesis:PutRecord']"
    },
    {
      "in": "aws_iam_role.discovery_event-adapter_role",
      "out": "aws_kinesis_stream.discovery_event-bus",
      "label": "['kinesis:PutRecords']"
    },
    {
      "in": "aws_lambda_function.discovery_event-adapter",
      "out": "aws_iam_role.discovery_event-adapter_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_default-config_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_default-config_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:Scan','dynamodb:GetItem','dynamodb:PutItem','dynamodb:DeleteItem','dynamodb:UpdateItem']"
    },
    {
      "in": "aws_lambda_function.discovery_default-config",
      "out": "aws_iam_role.discovery_default-config_role",
      "label": ""
    },
    {
      "in": "arn:aws:sns:us-east-1:309983114184:account_account-topic",
      "out": "aws_lambda_function.discovery_default-config",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_diff-tagging_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_diff-tagging_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/diff-engine/*",
      "label": "['s3:GetObject','s3:GetObjectTagging','s3:PutObjectVersionTagging','s3:PutObjectTagging']"
    },
    {
      "in": "aws_iam_role.discovery_diff-tagging_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/diff-tagging-failures/*",
      "label": "['s3:PutObject']"
    },
    {
      "in": "aws_iam_role.discovery_diff-tagging_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_diff-tagging_role",
      "out": "aws_kinesis_stream.stream",
      "label": "['kinesis:GetRecords','kinesis:GetShardIterator','kinesis:DescribeStream','kinesis:ListStreams']"
    },
    {
      "in": "aws_lambda_function.discovery_diff-tagging",
      "out": "aws_iam_role.discovery_diff-tagging_role",
      "label": ""
    },
    {
      "in": "arn:aws:kinesis:us-east-1:309983114184:stream/discovery_event-bus",
      "out": "aws_lambda_function.discovery_diff-tagging",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_dynamodb_table.authorisation_token",
      "label": "['dynamodb:GetItem','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_dynamodb_table.authentication_key",
      "label": "['dynamodb:GetItem','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_dynamodb_table.discovery_consistency-data",
      "label": "['dynamodb:Scan','dynamodb:Query','dynamodb:GetItem','dynamodb:PutItem','dynamodb:DeleteItem','dynamodb:UpdateItem']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_dynamodb_table.discovery_provider-consistency",
      "label": "['dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/diff-engine/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/consistency/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/consistency/*",
      "label": "['s3:PutObject']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/env/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_sqs_queue.discovery_consistency-checker-queue",
      "label": "['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_sqs_queue.discovery_consistency-checker-deadletter-queue",
      "label": "['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_consistency-checker_role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_lambda_function.discovery_consistency-checker",
      "out": "aws_iam_role.discovery_consistency-checker_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_machine-types-sync_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_machine-types-sync_role",
      "out": "aws_dynamodb_table.authorisation_token",
      "label": "['dynamodb:GetItem','dynamodb:Query','dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_machine-types-sync_role",
      "out": "aws_dynamodb_table.authentication_key",
      "label": "['dynamodb:GetItem','dynamodb:Query','dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_machine-types-sync_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:GetItem','dynamodb:Query','dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_machine-types-sync_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/instance-specification/*",
      "label": "['s3:PutObject']"
    },
    {
      "in": "aws_iam_role.discovery_machine-types-sync_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/env/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_machine-types-sync_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_lambda_function.discovery_machine-types-sync",
      "out": "aws_iam_role.discovery_machine-types-sync_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_dynamodb_table.authorisation_token",
      "label": "['dynamodb:GetItem','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_dynamodb_table.authentication_key",
      "label": "['dynamodb:GetItem','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_dynamodb_table.discovery_provider-consistency",
      "label": "['dynamodb:GetItem','dynamodb:PutItem','dynamodb:UpdateItem']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/env/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_sqs_queue.discovery_provider-consistency-queue",
      "label": "['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_sqs_queue.discovery_provider-consistency-deadletter-queue",
      "label": "['sqs:GetQueueAttributes','sqs:DeleteMessage','sqs:ChangeMessageVisibility','sqs:DeleteMessageBatch','sqs:ChangeMessageVisibilityBatch','sqs:ReceiveMessage']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_sns_topic.discovery_provider-inconsistency-topic",
      "label": "['sns:Publish']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-checker_role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_lambda_function.discovery_provider-consistency-checker",
      "out": "aws_iam_role.discovery_provider-consistency-checker_role",
      "label": ""
    },
    {
      "in": "aws_sqs_queue.discovery_provider-consistency-queue",
      "out": "aws_lambda_function.discovery_provider-consistency-checker",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_dynamodb_table.authorisation_token",
      "label": "['dynamodb:GetItem','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_dynamodb_table.authentication_key",
      "label": "['dynamodb:GetItem','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_dynamodb_table.discovery_tenant-config",
      "label": "['dynamodb:Scan','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_dynamodb_table.discovery_provider-consistency",
      "label": "['dynamodb:Scan','dynamodb:Query']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/env/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/consistency/*",
      "label": "['s3:GetObject','s3:PutObject','s3:DeleteObject']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_sqs_queue.discovery_provider-consistency-queue",
      "label": "['sqs:GetQueueUrl','sqs:SendMessage','sqs:SendMessageBatch']"
    },
    {
      "in": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_lambda_function.discovery_provider-consistency-scheduler",
      "out": "aws_iam_role.discovery_provider-consistency-scheduler_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_sqs-replayer_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_sqs-replayer_role",
      "out": "aws_sqs_queue.discovery_publisher-queue",
      "label": "['sqs:GetQueueUrl','sqs:ReceiveMessage','sqs:SendMessage','sqs:DeleteMessage']"
    },
    {
      "in": "aws_iam_role.discovery_sqs-replayer_role",
      "out": "aws_sqs_queue.discovery_publisher-deadletter-queue",
      "label": "['sqs:GetQueueUrl','sqs:ReceiveMessage','sqs:SendMessage','sqs:DeleteMessage']"
    },
    {
      "in": "aws_iam_role.discovery_sqs-replayer_role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_lambda_function.discovery_sqs-replayer",
      "out": "aws_iam_role.discovery_sqs-replayer_role",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "aws_dynamodb_table.discovery_collector-config",
      "label": "['dynamodb:GetItem','dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "aws_dynamodb_table.account_account",
      "label": "['dynamodb:GetItem','dynamodb:Scan']"
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/discovered-resources/*",
      "label": "['s3:PutObject']"
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1",
      "label": "['s3:ListBucket']"
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "aws_sqs_queue.discovery_decommission-queue",
      "label": "['sqs:GetQueueAttributes','sqs:GetQueueUrl','sqs:ReceiveMessage','sqs:SendMessage','sqs:DeleteMessage']"
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "aws_sqs_queue.discovery_decommission-deadletter-queue",
      "label": "['sqs:GetQueueAttributes','sqs:GetQueueUrl','sqs:ReceiveMessage','sqs:SendMessage','sqs:DeleteMessage']"
    },
    {
      "in": "aws_iam_role.discovery_decommission_role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_lambda_function.discovery_decommission",
      "out": "aws_iam_role.discovery_decommission_role",
      "label": ""
    },
    {
      "in": "arn:aws:sns:us-east-1:309983114184:account_account-topic",
      "out": "aws_lambda_function.discovery_decommission",
      "label": ""
    },
    {
      "in": "aws_sqs_queue.discovery_decommission-queue",
      "out": "aws_lambda_function.discovery_decommission",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_remediate-missing-resources_role",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "aws_iam_role.discovery_remediate-missing-resources_role",
      "out": "aws_s3_bucket.acp-platform-s-discovery-sandbox1/env/*",
      "label": "['s3:GetObject']"
    },
    {
      "in": "aws_iam_role.discovery_remediate-missing-resources_role",
      "out": "aws_sqs_queue.sre_auto-remediation-queue",
      "label": "['sqs:GetQueueUrl','sqs:SendMessage','sqs:SendMessageBatch']"
    },
    {
      "in": "aws_iam_role.discovery_remediate-missing-resources_role",
      "out": "aws_kms_key.discovery_master-key",
      "label": "['kms:GenerateDataKey*','kms:Decrypt']"
    },
    {
      "in": "aws_lambda_function.discovery_remediate-missing-resources",
      "out": "aws_iam_role.discovery_remediate-missing-resources_role",
      "label": ""
    },
    {
      "in": "aws_sns_topic.discovery_provider-inconsistency-topic",
      "out": "aws_lambda_function.discovery_remediate-missing-resources",
      "label": ""
    },
    {
      "in": "aws_iam_role.discovery_gateway-invoke-lambda",
      "out": "aws_lambda_function.discovery_consistency-checker",
      "label": "['lambda:InvokeFunction']"
    },
    {
      "in": "aws_iam_role.discovery_gateway-invoke-lambda",
      "out": "aws_lambda_function.discovery_provider-consistency-checker",
      "label": "['lambda:InvokeFunction']"
    },
    {
      "in": "aws_iam_role.discovery_gateway-invoke-lambda",
      "out": "aws_lambda_function.discovery_provider-consistency-scheduler",
      "label": "['lambda:InvokeFunction']"
    },
    {
      "in": "aws_iam_role.discovery_gateway-invoke-lambda",
      "out": "aws_lambda_function.discovery_api",
      "label": "['lambda:InvokeFunction']"
    },
    {
      "in": "aws_iam_role.discovery_gateway-invoke-lambda",
      "out": "",
      "label": "['logs:CreateLogStream','logs:CreateLogGroup','logs:PutLogEvents']"
    },
    {
      "in": "arn:aws:s3:::acp-platform-s-discovery-sandbox1",
      "out": "aws_lambda_function.discovery_event-adapter",
      "label": ""
    },
    {
      "in": "aws_cloudwatch_event_rule.discovery_scheduler-rule",
      "out": "aws_lambda_function.discovery_scheduler",
      "label": ""
    },
    {
      "in": "aws_cloudwatch_event_rule.discovery_legacy-scheduler-rule",
      "out": "aws_lambda_function.discovery_legacy-scheduler",
      "label": ""
    },
    {
      "in": "aws_cloudwatch_event_rule.discovery_machine-types-sync-rule",
      "out": "aws_lambda_function.discovery_machine-types-sync",
      "label": ""
    },
    {
      "in": "aws_cloudwatch_event_rule.discovery_consistency-checker-scheduler-rule",
      "out": "aws_lambda_function.discovery_consistency-checker",
      "label": ""
    },
    {
      "in": "aws_cloudwatch_event_rule.discovery_provider-consistency-scheduler-rule",
      "out": "aws_lambda_function.discovery_provider-consistency-scheduler",
      "label": ""
    }
  ]
}